<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css">
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<style>

.iti {
    width: 100%;
}

.iti__flag {
    background-image: url("https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/img/flags.png");
}

@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    .iti__flag {
        background-image: url("https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/img/flags@2x.png");
    }
}

.error {
    border-color: #dc3545;
}

#theLoaderGif{
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display:none;
    z-index: 2;
}
#theLoaderGif img{
 width:100px;
}
.d-none{
    display: none !important;
}

#MFZ-NewCostCalForm * {
box-sizing: border-box;
margin: 0;
padding: 0;

}

.header-grid-MFZ {
display: grid;
grid-auto-flow: column;
align-content: center;
align-items: center;
column-gap: 20px;
}

.header-grid-MFZ h2{
margin-bottom: 0px;
color: #1C1C1C;
font-family: "Plus Jakarta Sans";
font-size: 16px;
font-style: normal;
font-weight: 700;
line-height: 24px;
}

.header-grid-MFZ img {
  width: 48px;
  height: 48px;
}

.iti__selected-flag{
    padding: 0 6px 0 8px !important;
}
.iti--separate-dial-code .iti__selected-flag {
    background-color: transparent !important;
}
.select2-results__option--selected {
    background-color: #F4F2FF !important;
}
#MFZ-NewCostCalForm .form-container {
    background: linear-gradient(131deg, rgba(16, 206, 166, 0.10) 7.48%, rgba(155, 149, 251, 0.10) 72.83%, rgba(75, 87, 251, 0.10) 98.46%);
max-width: 700px;
margin: 0 auto;
padding: 0 0 36px 0;
border-radius: 20px;

overflow: hidden;
position: relative;
}

#MFZ-NewCostCalForm .header {
display: flex;
justify-content: space-between;
align-items: center;
background: linear-gradient(102deg, rgba(212, 225, 248, 0.8) 0%, rgba(229, 216, 242, 0.8) 100%);
padding: 20px 24px;

border-radius: 20px 20px 0 0;
}

@media(max-width:768px){
#MFZ-NewCostCalForm .header{
    border-radius: 0px !important;
}
}
#MFZ-NewCostCalForm .icon i {
color: #6226FF;
}

#MFZ-NewCostCalForm .step-counter {
color: #494949;
font-family: "Plus Jakarta Sans";
font-size: 14px;
font-style: normal;
font-weight: 500;
line-height: 24px;
border-radius: 7px;
padding: 8px 0;
display: flex;
align-items: center;
justify-content: flex-end;
position: relative;
}

/* Summary page edit buttons */
.edit-button {
    background-color: #F4F2FF;
    color: #6226FF;
    border: 1px solid #6226FF;
    border-radius: 4px;
    padding: 4px 8px;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.edit-button:hover {
    background-color: #6226FF;
    color: white;
}

.edit-cell {
    width: 120px;
    text-align: center;
    vertical-align: top;
}

.edit-message {
    color: #808080;
    font-size: 11px;
    display: block;
    font-style: italic;
}

/* Inline editing styles */
.summary-container {
    display: flex;
    flex-direction: column;
    gap: 16px;
    padding: 24px 0 !important;
    max-width: 100%;
    margin: 0 auto;
}

.summary-card {
    position: relative;
    border-radius: 10px;
border: 1px solid rgba(6, 96, 58, 0.10);
background: rgba(255, 255, 255, 0.20);
    display: flex;
    flex-direction: column;
}

.summary-card-header {
    padding: 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid rgba(2, 153, 86, 0.10);
    padding: 6px 16px !important;

}

.summary-card-header h3 {
    margin: 0;
    color: #1C1C1C;
font-family: "Plus Jakarta Sans";
font-size: 14px;
font-style: normal;
font-weight: 700;
line-height: 24px; /* 171.429% */
}

.card-edit-button {
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
}

.card-edit-button img, .info-icon {
    width: 24px;
    height: 24px;
    object-fit: contain;
}

.summary-card-content {
    padding: 8px 16px !important;
}

.summary-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px !important;
    align-items: center;
}

.summary-item:last-child {
    margin-bottom: 0 !important;
}

.summary-label {
    color: #1C1C1C;
font-family: "Plus Jakarta Sans";
font-size: 14px;
font-style: normal;
font-weight: 600;
line-height: 24px; /* 171.429% */
}

.summary-label span {
    font-weight: 500;
    color: #666;
    margin-left: 4px;
}

.summary-value {
    font-size: 14px;
    font-weight: 500;
    color: #333;
}

#business-activities-cost {
    display: block;
    text-align: right;
    width: 100%;
    margin-top: 12px;
}

.price {
    color: #333;
    font-weight: 600;
}

.total-card {
    margin-top: 8px;
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    border: none;
    background: transparent;
}

.total-price {
    font-size: 18px;
    font-weight: 700;
    color: #333;
}

.activity-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin-bottom: 16px;
    width: 100%;
}

.activity-tag {
    background: linear-gradient(163deg, rgba(171, 129, 197, 0.20) 10.55%, rgba(66, 184, 198, 0.20) 118.78%);
    color: #1C1C1C;
    border: 1px solid #AB81C5;
    font-weight: 600;
    padding: 8px 12px !important;
    border-radius: 16px;
    font-size: 13px;
    display: inline-block;
}

/* Removed revert message style */

.summary-section {
    margin-bottom: 16px;
}

.summary-section h4 {
    font-size: 14px;
    color: #333;
    margin-bottom: 8px;
    font-weight: 600;
}

.cost-item {
    margin-top: 8px;
}

.addon-item-container {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin-bottom: 16px;
}

.addon-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
}

.addon-name {
    background: linear-gradient(163deg, rgba(171, 129, 197, 0.20) 10.55%, rgba(66, 184, 198, 0.20) 118.78%);
    color: #1C1C1C;
    border: 1px solid #AB81C5;
    font-weight: 600;
    padding: 4px 8px !important;
    border-radius: 16px;
    padding: 6px 12px;
    font-size: 13px;
    font-size: 12px;
    color: #333;
    margin-right: auto;
}

.addon-cost {
    color: #000;
font-family: "Plus Jakarta Sans";
font-size: 14px;
font-style: normal;
font-weight: 600;
line-height: 24px; /* 171.429% */
    text-align: right;
    margin-left: auto;
}

.no-addons {
    font-size: 14px;
    color: #666;
    font-style: italic;
}

.edit-cell .addons-edit-group div {
    margin-bottom: 6px;
}

.discount-note {
    font-family: "Plus Jakarta Sans";
font-size: 14px;
font-style: normal;
font-weight: 400;
margin-top: 8px !important;
line-height: 16.8px; 
background: linear-gradient(102deg, #EB5F400 0%, #B5348B 100%);
background-clip: text !important;
-webkit-background-clip: text !important;
-webkit-text-fill-color: transparent !important;
}

#MFZ-NewCostCalForm .step-counter::before {
content: none;
}

#MFZ-NewCostCalForm .stepper-container {
  display: none; 
}

#MFZ-NewCostCalForm .form-step-title {
    color: #000;
font-family: "Plus Jakarta Sans";
font-size: 18px;
font-style: normal;
font-weight: 600;
line-height: 24px; 
margin-top: 36px;
padding-bottom: 8px;
}

.progress-container {
  position: relative;
  height: 8px;
  background-color: #F3F3F3;
  margin-bottom: 40px;
}

#MFZ-NewCostCalForm .step-progress {
  position: absolute;
  top: 0;
  left: 0;
  height: 8px;
  background: linear-gradient(102deg, #EB5F400 0%, #B5348B 100%);
  z-index: 1;
  border-radius: 0px 15px 15px 0px;
  transition: width 0.3s ease;
    width: 12%; 
}

#MFZ-NewCostCalForm .form-step-container {
  padding: 0 24px;
}

#MFZ-NewCostCalForm #heading-top-right-numbs-steps-1 {
  position: relative;
  z-index: 2;
text-align: right;
color: #1C1C1C;
}

#MFZ-NewCostCalForm #heading-top-right-numbs-steps-1 span {
color: #1C1C1C;
}

#MFZ-NewCostCalForm .step-counter span {
color: #494949 !important;
}

#MFZ-NewCostCalForm .step-counter #current-step {
  color: white;
}

#MFZ-NewCostCalForm .step-labels-container {
  display: flex;
  justify-content: space-between;
  margin-bottom: 30px;
  padding: 0 5px;
}

#MFZ-NewCostCalForm .step-label {
  font-size: 12px;
  color: #808080;
  text-align: center;

  max-width: 100px;
}

#MFZ-NewCostCalForm #step-indicator-1.active ~ #step-1-label,
#MFZ-NewCostCalForm #step-indicator-1.completed ~ #step-1-label,
#MFZ-NewCostCalForm #step-indicator-2.active ~ #step-2-label,
#MFZ-NewCostCalForm #step-indicator-2.completed ~ #step-2-label,
#MFZ-NewCostCalForm #step-indicator-3.active ~ #step-3-label,
#MFZ-NewCostCalForm #step-indicator-3.completed ~ #step-3-label,
#MFZ-NewCostCalForm #step-indicator-4.active ~ #step-4-label,
#MFZ-NewCostCalForm #step-indicator-4.completed ~ #step-4-label {
  color: #6226FF;

}

#MFZ-NewCostCalForm .form-step {
display: none;
animation: fadeIn 0.5s ease-in-out;
min-height: 400px;
}

#MFZ-NewCostCalForm .form-step.active {
display: block;
}

@keyframes fadeIn {
from { opacity: 0; }
to { opacity: 1; }
}

#MFZ-NewCostCalForm h2 {
color: #333;
}

#MFZ-NewCostCalForm .form-group {
margin-bottom: 20px;
}

#MFZ-NewCostCalForm label {

margin-bottom: 10px;
display: flex;
    flex-direction: row;
    align-items: center;

    width: 100%;
    justify-content: space-between;
color: #333;
margin-top: 12px;
margin-bottom: 12px;
}

#MFZ-NewCostCalForm input[type="text"],
#MFZ-NewCostCalForm input[type="email"],
#MFZ-NewCostCalForm input[type="tel"],
#MFZ-NewCostCalForm input[type="number"],
#MFZ-NewCostCalForm select {
width: 100%;
padding: 12px 16px;
border: none;

border-radius: 8px;
border: 1px solid #EDEDED;
background: #FFF;
font-size: 1em;

}

#MFZ-NewCostCalForm input[type="text"]:focus,
#MFZ-NewCostCalForm input[type="email"]:focus,
#MFZ-NewCostCalForm input[type="tel"]:focus,
#MFZ-NewCostCalForm input[type="number"]:focus,
#MFZ-NewCostCalForm select:focus {

outline: none;
border: none;
border: 1px solid #EDEDED;

}

#MFZ-NewCostCalForm select {

-webkit-appearance: none;
-moz-appearance: none;
appearance: none;
color: black;
background: url(https://cdn.prod.website-files.com/6746fa16829349829922b7c4/681296908fac04978eeaa8ad_45dfcaee6036e0619a664f55eb31e562_Icon1.svg) no-repeat;
background-position: 99% center;
background-size: 10px;
background-color: white;

}

#MFZ-NewCostCalForm .phone-input {
display: flex;
gap: 10px;
}

#MFZ-NewCostCalForm .phone-input select {
width: 30%;
}

#MFZ-NewCostCalForm .shareholder-input {
margin-top: 10px;
display: flex;
flex-direction: column;
 
}

#MFZ-NewCostCalForm .add-activity {
    width: 100%;
    margin-top: 0;
}

#MFZ-NewCostCalForm #add-activity-btn {
    display: none !important;
}

#MFZ-NewCostCalForm .selected-activities {
    display: none;
}

#MFZ-NewCostCalForm .note {
display: block;
margin-top: 5px;
color: #6226FF;
font-size: 0.9em;
}

#MFZ-NewCostCalForm .license-options {
margin-top:10px;
display: grid;
grid-auto-flow: row;
row-gap:20px;
}

#MFZ-NewCostCalForm .license-option {
border-radius: 16px;

display: grid;
grid-auto-flow: column;
align-items: center;
justify-content: start;
padding-left: 60px;
color: var(--blacks-black-90-n, #1C1C1C);
font-family: "Plus Jakarta Sans";
font-size: 18px;
font-style: normal;
font-weight: 400;
line-height: 24px;
margin-top: 24px;
}

#MFZ-NewCostCalForm .license-option input {
margin-right: 10px;
}

#MFZ-NewCostCalForm table {
width: 100%;
border: none;
margin-top: 20px;

border-spacing: 0;
border-collapse: separate;
border-radius: 10px;
}

#MFZ-NewCostCalForm table td {
padding: 3px;
border: none;
background: white;
color: var(--blacks-black-100-n, #111);
font-family: "Plus Jakarta Sans";
font-size: 14px;
font-style: normal;
line-height: 24px;
}

#license-cost,#visa-cost,#total-cost,#bank-account-cost,#summary-discount, #summary-package-type, #summary-license-duration, #summary-investor-visas, #summary-employee-visas, #summary-business-activities, #summary-shareholders-range, #summary-nationalities, #summary-total-cost, #summary-discount-percentage {
    text-align:end
}

#MFZ-NewCostCalForm table tr:nth-child(even) {
background-color: white;
}



#MFZ-NewCostCalForm .form-navigation {
display: flex;
justify-content: space-between;
align-items: center;
margin-top: 30px;
padding: 0px 24px;
border-radius: 0 0 20px 20px;
}
@media(max-width:428px) {
#MFZ-NewCostCalForm .form-navigation{
    margin-bottom: -25px;
}
}
#MFZ-NewCostCalForm .form-navigation button {
padding: 10px 20px;
border: none;
background: #195137;
color: #fff;
border-radius: 25px;
cursor: pointer;
font-size: 1em;
transition: background-color 0.3s;
min-width: 140px;
height: 48px;
display: flex;
align-items: center;
justify-content: center;
}

#MFZ-NewCostCalForm .form-navigation button:hover {
    background: linear-gradient(102deg, #61a60e 0%, #004a98 100%);
}


#MFZ-NewCostCalForm  #prevBtn{
background: #FFF;
color: #240B6A;
border: 1px solid #F3F3F3;
}

#MFZ-NewCostCalForm #nextBtn,
#MFZ-NewCostCalForm #submitBtn {
display: flex;
align-items: center;
justify-content: center;
gap: 5px;
}

#submitBtn{
background: #195137;

}
#submitBtn:hover{
    background: linear-gradient(90deg, #6226FF 0%, #3B1799 100%);

}

#shareholder-inputs input{
margin-bottom:10px
}

#MFZ-NewCostCalForm .form-navigation button:hover {
background-color: #240B6A;
}

#MFZ-NewCostCalForm #prevBtn {
background-color: #DDDDDD;
justify-self: start;
color: #1C1C1C;
}

#MFZ-NewCostCalForm #prevBtn:hover {
background-color: transparent;
border: 1px solid #1C1C1C;

}

.license-option {
position: relative;
padding-left: 35px;
cursor: pointer;
display: inline-block;
font-size: 18px;
}

.license-option input[type="radio"] {
position: absolute;
opacity: 1;
cursor: pointer;
}

.license-option .placeholder-circle {
position: absolute;
top: 31px;
left: 22px;
width: 25px;
height: 25px;
background-color: #F4F2FF;
border-radius: 50%;
}

.license-option .checkmark-MFZ {
display: inline-block;
position: absolute;
top: 31px;
left: 22px;
width: 25px;
height: 25px;
}

.license-option input[type="radio"]:checked ~ .placeholder-circle {
display: inline-block;
}

.license-option input[type="radio"]:checked ~ .checkmark-MFZ {
display: inline-block;

}
.license-option input[type="radio"]:checked ~ .license-option{
border: 1px solid green !important;

}


#MFZ-NewCostCalForm #MFZ-total-T-Cost-css td{
font-size: 19px;
color: #240B6A;
border-top:1px solid #80808029;
}

@media(max-width:768px){
#MFZ-NewCostCalForm .form-container{
    border-radius: 0px !important;
}
#MFZ-NewCostCalForm .phone-input select {
    width: 40%;
    font-size: 12px;
  }
}

.error-message {
    color: #dc3545;
    font-size: 14px;
    margin-top: 15px;
    display: block;
}

.button-loading {
    position: relative;
    opacity: 0.5;
    cursor: not-allowed !important;
}

.button-loading span,
.button-loading svg {
    visibility: hidden;
}

.button-loading::after {
    content: '';
    position: absolute;
    left: 50%;
    top: 50%;
    width: 20px;
    height: 20px;
    border: 2px solid #ffffff;
    border-radius: 50%;
    border-top-color: transparent;
    transform: translate(-50%, -50%);
    animation: button-loading-spinner 0.8s linear infinite;
}

@keyframes button-loading-spinner {
    from {
        transform: translate(-50%, -50%) rotate(0deg);
    }
    to {
        transform: translate(-50%, -50%) rotate(360deg);
    }
}



.iti {
    width: 100%;
}

.iti__flag {
    background-image: url("https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/img/flags.png");
}

@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    .iti__flag {
        background-image: url("https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/img/flags@2x.png");
    }
}

.error {
    border-color: #dc3545;
}

/* Add styles for the nationality dropdown to match other dropdowns */
.nationality-select {
    width: 100%;
    padding: 10px 15px;
    border: none;
    border-radius: 5px;
    font-size: 1em;
    background-color: white;
    margin-bottom: 10px;
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    background: url(https://cdn.prod.website-files.com/6746fa16829349829922b7c4/67756f26013b809b43a2c9bd_2bc6d774f44f463a510e3f2e562f66b87d9af327dd8a32323c4be73c8913bc86.webp) no-repeat;
    background-position: 96% center;
    background-size: 20px;
    background-color: white;
    color: black;
}

.nationality-select:focus {
    outline: none;
}

.nationality-select option {
    padding: 10px;
}


.nationality-select.error {
    border: 1px solid #dc3545;
}


@media (max-width: 767px) {
    .nationality-select {
        padding: 8px 12px;
    }
}


.select2-container {
    margin-bottom: 10px !important;

}


.select2-container--default .select2-selection--single {
    width: 100% !important;
    height: auto !important;
    padding: 10px 15px !important;
    border: none !important;
    border-radius: 8px !important;
    border: 1px solid #EDEDED;    font-size: 1em !important;
    font-family: inherit !important;
    background-color: white !important;
    background: white url(https://cdn.prod.website-files.com/6746fa16829349829922b7c4/681296908fac04978eeaa8ad_45dfcaee6036e0619a664f55eb31e562_Icon1.svg) no-repeat !important;
    background-position: 99% center !important;
    background-size: 10px !important;
    color: black !important;
    box-shadow: none !important;
    margin: 0 !important;
}


.select2-container--default .select2-selection--single .select2-selection__arrow {
    display: none !important;
}


.select2-container--default .select2-selection--single .select2-selection__rendered {
    color: black !important;
    line-height: normal !important;
    padding-left: 0 !important;
    font-family: inherit !important;
    font-weight: normal !important;
}


.select2-container--default .select2-selection--single .select2-selection__placeholder {
    color: #757575 !important;
}


.select2-dropdown {
    border: none !important;
    border-radius: 5px !important;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1) !important;
    font-family: inherit !important;
}


.select2-container--default .select2-search--dropdown .select2-search__field {
    line-height: 1rem;
    border: 1px solid #ddd !important;
    border-radius: 5px !important;
    padding: 8px !important;
    font-family: inherit !important;
}

.select2-container--default .select2-search--dropdown .select2-search__field:focus {
    outline: none !important;
    border-color: #61a60e !important;
}


.select2-results__option {
    padding: 10px 15px !important;
    font-family: inherit !important;
}

.select2-container--default .select2-results__option--highlighted[aria-selected] {
    background-color: #62a60e13!important;
    color: #61a60e !important;
}


.select2-container--default.select2-error .select2-selection--single {
    border: 1px solid #dc3545 !important;
}


@media (max-width: 767px) {
    .select2-container--default .select2-selection--single {
        padding: 8px 12px !important;
    }
}


.select2-container--open .select2-dropdown--below {
    margin-top: 0 !important;
}


.select2-results__option {
    padding: 10px 15px !important;
    font-family: inherit !important;
}


.select2-container .select2-selection--single {
    height: auto !important;
}


.select2-container--default .select2-selection--single .select2-selection__rendered {
    line-height: 1.5 !important;
}


.select2-container--default .select2-selection--single .select2-selection__placeholder {
    color: #757575 !important;
}


.select2-container--open .select2-dropdown {

    min-width: 100% !important;
}


.select2-results {
    background-color: white !important;
}

.select2-results__options {
    max-height: 200px !important;
    overflow-y: auto !important;
}

.nationality-dropdown {
    display: none !important;
}

#theFinalSuccessMessage {
    display: none; 
    flex-direction: column;
    justify-content: center;
    align-items: center;
    min-height: 400px;
    text-align: center;
    position: relative;
    z-index: 100;
    background-color: white;
    width: 100%;
    padding: 30px;
}

.nationality-dropdown .select2-results__option {
    padding: 10px 15px;
}

#MFZ-NewCostCalForm .step-text-white,
#MFZ-NewCostCalForm .step-text-white span,
#MFZ-NewCostCalForm .step-text-white .step-word {
color: white !important;

}

#MFZ-NewCostCalForm .step-text-colored,
#MFZ-NewCostCalForm .step-text-colored span,
#MFZ-NewCostCalForm .step-text-colored .step-word {
color: #494949 !important;

}

#MFZ-NewCostCalForm .step-word {
display: inline-block;
}

#MFZ-NewCostCalForm #multiStepForm {
min-height: 450px;
position: relative;
display: flex;
flex-direction: column;
}

#nextBtn, #submitBtn {
margin-left: auto;
}

.form-step-container {
  min-height: 400px;
  display: flex;
  flex-direction: column;
  margin-bottom: 30px;
}

.top-border-image {
  height: 34px !important;
  width: 100% !important;
  position: absolute !important;
  top: 0 !important;
  left: 0 !important;
  object-fit: cover !important;
  border-radius: 20px 20px 0 0 !important;
}

.form-row {
    display: flex;
    gap: 20px;
    margin-bottom: 0;
}

.form-col {
    flex: 1;
}

@media(max-width: 767px) {
    .form-row {
        flex-direction: column;
        gap: 0;
    }
}

.select2-container--default .select2-selection--multiple {
    border: none !important;
    border-bottom: 0.899px solid rgba(0, 0, 0, 0.60) !important;
    padding: 5px 0 !important;
    min-height: 50px !important;
    background-color: white !important;
}

.select2-container--default .select2-selection--multiple .select2-selection__rendered {
    display: flex !important;
    flex-wrap: wrap !important;
    gap: 10px !important;
    padding: 0 !important;
    margin-top: 10px !important;
}

.select2-container--default .select2-selection--multiple .select2-selection__choice {
    background-color: transparent !important;
    border: none !important;
    padding: 0 !important;
    margin: 3px !important;
}

.select2-container--default.select2-container--focus .select2-selection--multiple {
    border: none !important;
    border-bottom: 0.899px solid #6226FF !important;
    outline: none !important;
}

.select2-container--default .select2-selection--multiple .select2-search__field::placeholder {
    color: #757575 !important;
}

.select2-container--default .select2-selection--multiple .select2-search--inline .select2-search__field {
    margin-top: 5px !important;
    margin-left: 5px !important;
}

.select2-container--default .select2-selection--multiple {
    margin-top: 10px !important;
}

.select2-selection__choice__remove span {
    display: none !important;
}

.select2-container--default .select2-selection--multiple .select2-selection__choice {
    padding: 8px 15px !important;
    background-color: #F4F2FF !important;
    color: #240B6A !important;
    border-radius: 50px !important;
    position: relative !important;
    margin: 5px !important;
    border: none !important;
    overflow: visible !important;
}

.select2-container--default .select2-selection--multiple .select2-selection__choice__remove {
    position: absolute !important;
    top: -5px !important;
    right: -10px !important;
    background: #fff !important;
    color: #6226FF !important;
    border-radius: 50% !important;
    width: 20px !important;
    height: 20px !important;
    text-align: center !important;
    line-height: 15px !important;
    cursor: pointer !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    border: none !important;
    padding: 0 !important;
    margin: 0 !important;
    opacity: 1 !important;
    font-size: 16px !important;
}

.select2-container--default .select2-selection--multiple .select2-selection__choice__remove span {
    display: none !important;
}

.select2-container--default .select2-selection--multiple .select2-selection__choice__remove::after {
    content: "×";
    display: block;
    font-size: 16px;
    font-weight: bold;
}

.select2-container--default .select2-selection--multiple {
    padding: 0 !important;
    margin-top: 10px !important;
    background-color: transparent !important;
}

#MFZ-NewCostCalForm input[type="number"]::-webkit-inner-spin-button,
#MFZ-NewCostCalForm input[type="number"]::-webkit-outer-spin-button {
    -webkit-appearance: none;
    appearance: none;
    margin: 0;
}
#MFZ-NewCostCalForm input[type="number"] {
    -moz-appearance: textfield; 
    appearance: textfield; 
}

.cost-disclaimer {
    margin-top: 40px !important;
    font-family: "Plus Jakarta Sans";
    font-size: 14px;
    font-style: normal;
    font-weight: 300;
    line-height: 24px;
    text-align: left;
    opacity: 0.6;
    color: #06070B;
}

.included-features {
    margin-top: 25px !important;

    padding-top: 25px;
}

.included-features h4 {
    font-family: "Plus Jakarta Sans";
    font-size: 18px;
    font-weight: 500;
    color: #240B6A;
    margin-bottom: 20px;
}

.features-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
}

.feature-item {
    display: flex;
    align-items: center;
    gap: 10px;
}

.feature-item i {
    color: #6226FF;
    font-size: 16px;
    margin-top: 4px;
}

.feature-item span {
color:  #240B6A;
font-family: "Plus Jakarta Sans";
font-size: 16px;
font-style: normal;
font-weight: 400;
line-height: 32.359px;
}

@media(max-width: 767px) {
    .features-grid {
        grid-template-columns: 1fr;
    }
}

#theFinalSuccessMessage h2 {
    font-family: "Plus Jakarta Sans";
    font-size: 32px;
    font-style: normal;
    font-weight: 400;
    line-height: 38.4px;
    background: linear-gradient(244deg, #1C1B1A 0%, #703CF9 100%);
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 20px;
}

#theFinalSuccessMessage p {
    font-family: "Plus Jakarta Sans";
    font-size: 18px;
    line-height: 28px;
    color: #444;
    max-width: 500px;
}

#theFinalSuccessMessage.visible {
    display: flex !important;
    opacity: 1 !important;
    visibility: visible !important;
}

#MFZ-NewCostCalForm .license-type-options {
    display: flex;
    gap: 12px;

    width: 100%;
}

#MFZ-NewCostCalForm .license-option {
    display: flex;
    align-items: center;
    position: relative;
    cursor: pointer;
    padding: 12px 0px;
    border-radius: 8px;
    flex: 1;
}

#MFZ-NewCostCalForm .license-option label {
    margin: 0 0 0 0;
    color: #333;
    font-family: "Plus Jakarta Sans";
    font-weight: 500;
    cursor: pointer;
}

#MFZ-NewCostCalForm .license-option input[type="radio"] {
    appearance: none;
    -webkit-appearance: none;
    width: 24px;
    height: 24px;
    border: 1px solid #E0E0E0;
    border-radius: 4px;
    outline: none;
    cursor: pointer;
    margin: 0 12px 0 0;
}

#MFZ-NewCostCalForm .license-option input[type="radio"] {
    margin: 0 12px 0 0;
    width: 24px;
    height: 24px;
    border-radius: 4px;
    border: 1px solid #AB81C5;
    position: relative;
}

#MFZ-NewCostCalForm .license-option input[type="radio"]:checked {
    border: none;
    background: linear-gradient(163deg, #AB81C5 10.55%, #42B8C6 118.78%);
    position: relative;
}

#MFZ-NewCostCalForm .license-option input[type="radio"]:checked::after {
    content: "";
    position: absolute;
    top: 7px;
    left: 6px;
    width: 10px;
    height: 5px;
    border-left: 2px solid white;
    border-bottom: 2px solid white;
    transform: rotate(-45deg);
    border-radius: 0;
}

#MFZ-NewCostCalForm .license-option:hover {
    border-color: #195137;
}

#MFZ-NewCostCalForm .duration-info {
    margin-bottom: 36px;

}

#MFZ-NewCostCalForm .duration-info p {
    font-family: "Plus Jakarta Sans";
    font-size: 1٤px;
    color: #333;
    margin: 0;
}

#MFZ-NewCostCalForm .duration-value {
    background: var(--Orange, linear-gradient(102deg, #EB5F400 0%, #B5348B 100%));
background-clip: text;
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
    font-weight: 700;
}

#MFZ-NewCostCalForm .toggle-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 20px;
    margin-bottom: 10px;
    padding: 15px 20px;
    background-color: #fff;
    border-radius: 10px;
    box-shadow: 0px 4px 14px rgba(104, 104, 104, 0.08);
}

#MFZ-NewCostCalForm .toggle-label {
    font-family: "Plus Jakarta Sans";
    font-size: 18px;
    font-weight: 500;
    color: #333;
}

#MFZ-NewCostCalForm .toggle-switch {
    position: relative;
    display: inline-block;
    width: 76px;
    height: 34px;
}

#MFZ-NewCostCalForm .toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

#MFZ-NewCostCalForm .toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: -12px;
    bottom: 0;
    background-color: white;
    border: 1px solid #E0E0E0;
    transition: .4s;
    border-radius: 34px;
    display: flex;
    align-items: center;
    padding: 0 4px;
    box-sizing: border-box;
}

#MFZ-NewCostCalForm .toggle-slider:before {
    position: absolute;
    content: "";
    height: 26px;
    width: 26px;
    right: 4px;
    bottom: 3px;
    background: linear-gradient(163deg, #AB81C5 10.55%, #42B8C6 118.78%);
    transition: .4s;
    border-radius: 50%;
    z-index: 1;
}

#MFZ-NewCostCalForm .toggle-yes,
#MFZ-NewCostCalForm .toggle-no {
    position: absolute;
    font-size: 12px;
    font-weight: 700;
    color: #333;
    font-family: "Plus Jakarta Sans";
    transition: opacity 0.3s;
}

#MFZ-NewCostCalForm .toggle-yes {
    left: 37px;
    opacity: 0;
}

#MFZ-NewCostCalForm .toggle-no {
    right: 42px;
    opacity: 1;
}

#MFZ-NewCostCalForm .toggle-switch input:checked + .toggle-slider {
    background-color: white;
}

#MFZ-NewCostCalForm .toggle-switch input:checked + .toggle-slider:before {
    transform: translateX(-42px);
    background: linear-gradient(102deg, #61a60e 0%, #004a98 100%);
}

#MFZ-NewCostCalForm .toggle-switch input:checked + .toggle-slider .toggle-yes {
    opacity: 1;
}

#MFZ-NewCostCalForm .toggle-switch input:checked + .toggle-slider .toggle-no {
    opacity: 0;
}

#MFZ-NewCostCalForm .visa-options {
    display: flex;
    flex-direction: column;
    margin-top: 20px;
}

#MFZ-NewCostCalForm .visa-option {
    display: flex;
    flex-direction: column;
}

#MFZ-NewCostCalForm .visa-toggle {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 5px 0;
}

#MFZ-NewCostCalForm .visa-label {
    color: #1C1C1C;
    font-family: "Plus Jakarta Sans";
    font-size: 14px;
    font-style: normal;
    font-weight: 700;
    line-height: 24px; 
    margin: 0;
}


#MFZ-NewCostCalForm .services-category {
    margin-bottom: 16px;
}

#MFZ-NewCostCalForm .services-category h4 {
    background: linear-gradient(163deg, #AB81C5 10.55%, #42B8C6 118.78%);
background-clip: text;
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
font-family: "Plus Jakarta Sans";
font-size: 16px;
font-style: normal;
font-weight: 700;
line-height: 24px; 
}

#MFZ-NewCostCalForm .services-container {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin-top: 10px;
}

#MFZ-NewCostCalForm .service-option {
    position: relative;
}

#MFZ-NewCostCalForm .service-checkbox {
    position: absolute;
    opacity: 0;
    width: 0;
    height: 0;
}

#MFZ-NewCostCalForm .service-label {
    display: inline-block;
    padding: 12px 16px;
    border-radius: 40px;
    border: 1px solid #DCDCDC;
    background-color: transparent;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 12px;
    font-weight: 500;
    white-space: nowrap;
    font-family: "Plus Jakarta Sans";
    margin-top: 0px;
}

#MFZ-NewCostCalForm .service-checkbox:checked + .service-label {
    background: linear-gradient(163deg, rgba(171, 129, 197, 0.20) 10.55%, rgba(66, 184, 198, 0.20) 118.78%);
    color: #1C1C1C;
    border: 1px solid #AB81C5;
    font-weight: 700;
}


#MFZ-NewCostCalForm .tax-compliance-warning {
    margin-top: 15px;
    padding: 10px 15px;
    background-color: #fff9e9;
    border-left: 4px solid #ffcc00;
    border-radius: 4px;
}

#MFZ-NewCostCalForm .tax-compliance-warning p {
    margin: 0;
    color: #7a4500;
    font-size: 14px;
    font-family: "Plus Jakarta Sans";
    line-height: 1.4;
}

#MFZ-NewCostCalForm .form-step#step-3 {
    padding: 0;
}

#MFZ-NewCostCalForm .form-step#step-3 .form-step-title {
    padding-left: 24px;
    margin-bottom: 16px;
}


#MFZ-NewCostCalForm .activity-search-container {
    padding: 0 16px;
    margin-bottom: 24px;
    position: relative;
    box-sizing: border-box;
    width: 100%;
}

#MFZ-NewCostCalForm .activity-search-input {
    width: 100%;
    padding: 16px 48px 16px 16px;
    border-radius: 8px;
    border: 1px solid #E0E0E0;
    background-color: #fff;
    font-size: 16px;
    font-family: "Plus Jakarta Sans";
}

#MFZ-NewCostCalForm .activity-search-input:focus {
    outline: none;
    border-color: #AB81C5;
}

#MFZ-NewCostCalForm .search-icon {
    position: absolute;
    right: 32px;
    top: 50%;
    transform: translateY(-50%);
    color: #808080;
}
#MFZ-NewCostCalForm .search-icon svg{
    width: 18px;
    height: 18px;
}


#MFZ-NewCostCalForm .activity-groups-container {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    padding: 0 16px;
}

#MFZ-NewCostCalForm .activity-group {
    position: relative;
    padding: 12px 16px;
    border-radius: 40px;
  cursor: pointer !important;
    color: #333;
    font-family: "Plus Jakarta Sans";
    font-size: 12px;
    font-weight: 500;
    border: 1px solid #DCDCDC;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}

#MFZ-NewCostCalForm .activity-group.selected {
    background: linear-gradient(163deg, rgba(171, 129, 197, 0.20) 10.55%, rgba(66, 184, 198, 0.20) 118.78%);
    border: 1px solid #AB81C5;
    font-weight: 700;
}

#MFZ-NewCostCalForm .activity-group .plus-icon {
    display: none;
    width: 17px;
    height: 16px;
    position: relative;
    margin-left: 5px;
    vertical-align: middle;
    z-index: 1;
    line-height: 1;
    flex-shrink: 0;
    background-image: url('https://cdn.prod.website-files.com/6746fa16829349829922b7c4/684975e74ee24d70a6b27334_502ac5440775221a80f21723a925b9f8d45dd6d27cb02a7e8b195fa5c2906a9c.png');
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
}

#MFZ-NewCostCalForm .activity-group.selected .plus-icon {
    display: inline-flex !important;
    align-items: center;
    justify-content: center;
    visibility: visible !important;
}


#MFZ-NewCostCalForm .activity-group .plus-icon svg {
    display: none !important;
}


#MFZ-NewCostCalForm .activity-group.selected .plus-icon svg {
    display: none !important;
    width: 17px;
    height: 16px;
    visibility: hidden !important;
}


#MFZ-NewCostCalForm .activity-group .plus-icon svg path {

    stroke: #AB81C5;
    stroke-width: 1.5;
    stroke-linecap: round;
    stroke-linejoin: round;
}


#MFZ-NewCostCalForm .activity-group.selected .plus-icon svg path {
    stroke: #AB81C5;
    stroke-width: 1.5;
    stroke-linecap: round;
    stroke-linejoin: round;
}


#MFZ-NewCostCalForm .activity-count {
    display: none;
}

#MFZ-NewCostCalForm .activity-group.selected[data-count="0"] .activity-count {
    display: none;
}

#MFZ-NewCostCalForm .activity-group.selected[data-count="1"] .activity-count,
#MFZ-NewCostCalForm .activity-group.selected[data-count="2"] .activity-count,
#MFZ-NewCostCalForm .activity-group.selected[data-count="3"] .activity-count,
#MFZ-NewCostCalForm .activity-group.selected[data-count="4"] .activity-count,
#MFZ-NewCostCalForm .activity-group.selected[data-count="5"] .activity-count {
    display: inline;
}

#MFZ-NewCostCalForm .activity-count {
    opacity: 0.7;
}


#MFZ-NewCostCalForm .selection-summary {
    margin-top: 20px;
    padding: 0 16px;
    position: relative;
    z-index: 5;
}

#MFZ-NewCostCalForm .selection-summary p {
    font-family: "Plus Jakarta Sans";
    font-size: 16px;
    font-weight: 500;
    color: #333;
    margin-bottom: 8px;
}

#MFZ-NewCostCalForm .fee-warning {
    font-family: "Plus Jakarta Sans";
    font-size: 14px;
    font-style: normal;
    font-weight: 400;
    line-height: 24px; 
    background: linear-gradient(102deg, #EB5F400 0%, #B5348B 100%);
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.activity-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 12px;
}
#business-activities-summary{
    display: flex;
}

.total-card-header{
    border: none;
    background: transparent;
    font-size: 16px;
font-style: normal;
font-weight: 700;
}
</style>

<section id="MFZ-NewCostCalForm">
<div class="form-container">
    <div class="header">
        <div class="header-grid-MFZ">
            <div class="icon">
                <img src="https://cdn.prod.website-files.com/6746fa16829349829922b7c4/6847e3049112d43f19fa23da_Group%201000005348.svg" alt="Document with checkmark">
            </div>
            <h2 id="theHeading">Get Started</h2>
        </div>
        <div class="step-counter">
            <span id="heading-top-right-numbs-steps-1">
                <span class="step-word">Step</span> <span id="current-step">1</span>/7
            </span>
            <span id="heading-top-right-numbs-steps-2"></span>
        </div>
    </div>
    
    <div class="progress-container">
        <div class="step-progress"></div>
    </div>

    <form id="multiStepForm">
        <div class="form-step-container">
            <div class="form-step active" id="step-1">
                <h3 class="form-step-title">Fill in your details:</h3>
                <div class="form-group">
                    <label for="full-name">Enter your full name *</label>
                    <input type="text" id="full-name" placeholder="Your name" required>
                    <div class="error-message" id="full-name-error"></div>
                        </div>

                        <div class="form-group">
                    <label for="phone">Enter phone number *</label>
                    <div class="phone-input">
                        <input type="tel" id="phone" name="phone" class="form-control" placeholder="Phone number" required>
                    </div>
                    <div class="error-message" id="phone-error"></div>
                </div>

                <div class="form-group">
                    <label for="email">Enter email address *</label>
                <input type="email" id="email" placeholder="Email address" required>
                <div class="error-message" id="email-error"></div>
                    </div>

            </div>

                        <div class="form-step" id="step-2">
                <h3 class="form-step-title">Business License Type</h3>
                
                <div class="license-type-options">
                    <div class="license-option">
                        <input type="radio" id="fawri-license" name="license-type" value="fawri">
                        <label for="fawri-license">Fawri License</label>
                    </div>
                    <div class="license-option">
                        <input type="radio" id="regular-license" name="license-type" value="regular">
                        <label for="regular-license">Regular Business License</label>
                </div>
            </div>

                <div class="duration-info">
                    <p>Duration: <span class="duration-value">60 Minutes</span></p>
                </div>

               
                <div class="form-group">
                <label for="license-duration">Duration of Business License</label>
                    <select id="license-duration" aria-label="Duration of Business License" required>
                        <option value="" disabled selected>Select Years</option>
                        <option value="1">1 Year</option>
                        <option value="2">2 Years</option>
                        <option value="3">3 Years</option>
                        <option value="4">4 Years</option>
                        <option value="5">5 Years</option>
                        <option value="6">6 Years</option>
                        <option value="7">7 Years</option>
                    </select>
                    <div class="error-message" id="license-duration-error"></div>
                    <p class="discount-note">Discount on multi-year licenses</p>
                </div>

              <label for="shareholders-range">Number of Shareholders</label>
                <div class="form-group">
                     <select id="shareholders-range" aria-label="Number of Shareholders" required onchange="updateShareholderNationalities()">
                         <option value="" disabled selected>Select Number</option>
                         <option value="1">1</option>
                         <option value="2">2</option>
                         <option value="3">3</option>
                         <option value="4">4</option>
                         <option value="5">5</option>
                         <option value="6">6</option>
                    </select>
                    <div class="error-message" id="shareholders-range-error"></div>
                    <div id="shareholder-nationalities-container" class="shareholder-input"></div>
                </div>
                    </div>

            <div class="form-step" id="step-3">
                <h3 class="form-step-title">Please select your business activity group</h3>
                
                <div class="activity-search-container">
                    <input type="text" class="activity-search-input" placeholder="Search for activity" aria-label="Search for business activities">
                    <span class="search-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M11 19C15.4183 19 19 15.4183 19 11C19 6.58172 15.4183 3 11 3C6.58172 3 3 6.58172 3 11C3 15.4183 6.58172 19 11 19Z" stroke="#808080" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M21 21L16.65 16.65" stroke="#808080" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </span>
                    </div>
                
                <div class="activity-groups-container">
                    <div class="activity-group" data-group="administrative" data-count="0">
                        Administrative <span class="activity-count">(0)</span>
                        <span class="plus-icon">
                        </span>
                        </div>
                    <div class="activity-group" data-group="agriculture" data-count="0">
                        Agriculture <span class="activity-count">(0)</span>
                        <span class="plus-icon">
                        </span>
                    </div>
                    <div class="activity-group" data-group="art" data-count="0">
                        Art <span class="activity-count">(0)</span>
                        <span class="plus-icon">
                        </span>
                        </div>
                    <div class="activity-group" data-group="education" data-count="0">
                        Education <span class="activity-count">(0)</span>
                        <span class="plus-icon">
                        </span>
                </div>
                    <div class="activity-group" data-group="ict" data-count="0">
                        ICT <span class="activity-count">(0)</span>
                        <span class="plus-icon">
                        </span>
                    </div>
                    <div class="activity-group" data-group="fnb" data-count="0">
                        F&B, Rentals <span class="activity-count">(0)</span>
                        <span class="plus-icon">
                        </span>
                    </div>
                    <div class="activity-group" data-group="financial" data-count="0">
                        Financial <span class="activity-count">(0)</span>
                        <span class="plus-icon">
                        </span>
                    </div>
                    <div class="activity-group" data-group="healthcare" data-count="0">
                        Health Care <span class="activity-count">(0)</span>
                        <span class="plus-icon">
                        </span>
                    </div>
                    <div class="activity-group" data-group="maintenance" data-count="0">
                        Maintenance <span class="activity-count">(0)</span>
                        <span class="plus-icon">
                        </span>
                    </div>
                    <div class="activity-group" data-group="services" data-count="0">
                        Services <span class="activity-count">(0)</span>
                        <span class="plus-icon">
                        </span>
                    </div>
                    <div class="activity-group" data-group="professional" data-count="0">
                        Professional <span class="activity-count">(0)</span>
                        <span class="plus-icon">
                        </span>
                    </div>
                    <div class="activity-group" data-group="realestate" data-count="0">
                        Real Estate <span class="activity-count">(0)</span>
                        <span class="plus-icon">
                        </span>
                    </div>
                    <div class="activity-group" data-group="sewerage" data-count="0">
                        Sewerage <span class="activity-count">(0)</span>
                        <span class="plus-icon">
                        </span>
                    </div>
                    <div class="activity-group" data-group="trading" data-count="0">
                        Trading <span class="activity-count">(0)</span>
                        <span class="plus-icon">
                        </span>
                    </div>
                    <div class="activity-group" data-group="transportation" data-count="0">
                        Transportation <span class="activity-count">(0)</span>
                        <span class="plus-icon">
                        </span>
                    </div>
                    <div class="activity-group" data-group="waste" data-count="0">
                        Waste Collection <span class="activity-count">(0)</span>
                        <span class="plus-icon">
                        </span>
                    </div>
                    <div class="activity-group" data-group="manufacturing" data-count="0">
                        Manufacturing <span class="activity-count">(0)</span>
                        <span class="plus-icon">
                        </span>
            </div>
                <div id="activities-list-placeholder"></div>
                <div class="selection-summary">
                    <p>Groups Selected: <span id="groups-selected-count">0</span></p>
                    <p>Activities Selected: <span id="activities-selected-count">0</span></p>
                    <p class="fee-warning">You will be charged +AED 1,000 for each group activity above 3</p>
                </div>
                </div>
            </div>

            <div class="form-step" id="step-4">
                <div class="visa-options">
                    <div class="visa-option">
                        <div class="visa-toggle">
                            <label for="investor-visa-toggle" class="visa-label">Investor Visa</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="investor-visa-toggle" onchange="toggleVisaOptions('investor')" aria-label="Toggle investor visa options">
                                <span class="toggle-slider">
                                    <span class="toggle-no">NO</span>
                                    <span class="toggle-yes">YES</span>
                                </span>
                            </label>
                        </div>
                        <div id="investor-visa-options" style="display: none; margin-top: 10px;">
                            <select id="investor-visa-count" aria-label="Number of Investor Visas">
                                <option value="" disabled selected>Select number</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                    </select>
                            <div class="error-message" id="investor-visa-count-error"></div>
                </div>
            </div>

                    <div class="visa-option">
                        <div class="visa-toggle">
                            <label for="employee-visa-toggle" class="visa-label">Employee Visa</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="employee-visa-toggle" onchange="toggleVisaOptions('employee')" aria-label="Toggle employee visa options">
                                <span class="toggle-slider">
                                    <span class="toggle-no">NO</span>
                                    <span class="toggle-yes">YES</span>
                                </span>
                            </label>
                        </div>
                        <div id="employee-visa-options" style="display: none; margin-top: 10px;">
                            <select id="employee-visa-count" aria-label="Number of Employee Visas">
                                <option value="" disabled selected>Select number</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                    </select>
                            <div class="error-message" id="employee-visa-count-error"></div>
                        </div>
                </div>

                    <div class="visa-option">
                        <div class="visa-toggle">
                            <label for="dependency-visa-toggle" class="visa-label">Dependency Visa</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="dependency-visa-toggle" onchange="toggleVisaOptions('dependency')" aria-label="Toggle dependency visa options">
                                <span class="toggle-slider">
                                    <span class="toggle-no">NO</span>
                                    <span class="toggle-yes">YES</span>
                                </span>
                            </label>
                        </div>
                        <div id="dependency-visa-options" style="display: none; margin-top: 10px;">
                            <select id="dependency-visas" aria-label="Number of Dependency Visas">
                                <option value="" disabled selected>Select number</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                            </select>
                            <div class="error-message" id="dependency-visas-error"></div>
                        </div>
                    </div>
                        </div>
                    </div>

            <div class="form-step " id="step-5">
                <div class="office-options">
                    <h3 class="form-step-title" style="margin-bottom: 8px;">Please select your office type</h3>
                    <div class="form-field-container">
                        <select id="office-type" class="form-input" required aria-label="Office Type">
                            <option value="" disabled selected>Select your office type</option>
                            <option value="shared-office">Shared Office / Shared Desk</option>
                            <option value="dedicated-office">Dedicated Office</option>
                        </select>
                        <div class="error-message" id="office-type-error"></div>
                </div>
                    </div>
                </div>
                <div class="form-step" id="step-6">
                    <div class="addons-section">
                        <h3 class="form-step-title" style="margin-bottom: 24px;">Please select required services needed</h3>
                        
                        <div class="services-category">
                            <h4>mCore</h4>
                            <div class="services-container">
                                <div class="service-option">
                                    <input type="checkbox" id="bank-account" class="service-checkbox" value="bank-account">
                                    <label for="bank-account" class="service-label">Bank Account</label>
                            </div>
                                <div class="service-option">
                                    <input type="checkbox" id="business-card" class="service-checkbox" value="business-card">
                                    <label for="business-card" class="service-label">Business Card</label>
                        </div>
                                <div class="service-option">
                                    <input type="checkbox" id="company-stamp" class="service-checkbox" value="company-stamp">
                                    <label for="company-stamp" class="service-label">Company Stamp</label>
                                </div>
                                <div class="service-option">
                                    <input type="checkbox" id="ecommerce-starter" class="service-checkbox" value="ecommerce-starter">
                                    <label for="ecommerce-starter" class="service-label">E-commerce Starter</label>
                                </div>
                            </div>
                        </div>
    
                        <div class="services-category">
                            <h4>mResidency</h4>
                            <div class="services-container">
                                <div class="service-option">
                                    <input type="checkbox" id="medical-emirates-id" class="service-checkbox" value="medical-emirates-id">
                                    <label for="medical-emirates-id" class="service-label">Medical and Emirates ID</label>
                        </div>
                                <div class="service-option">
                                    <input type="checkbox" id="medical-insurance" class="service-checkbox" value="medical-insurance">
                                    <label for="medical-insurance" class="service-label">Medical Insurance</label>
                    </div>
                                <div class="service-option">
                                    <input type="checkbox" id="dependent-visa" class="service-checkbox" value="dependent-visa">
                                    <label for="dependent-visa" class="service-label">Dependent Visa</label>
                                </div>
                                <div class="service-option">
                                    <input type="checkbox" id="eid-card-delivery" class="service-checkbox" value="eid-card-delivery">
                                    <label for="eid-card-delivery" class="service-label">EID Card Delivery</label>
                                </div>
                                
                        </div>
                    </div>

                        <div class="services-category">
                            <h4>mAssist</h4>
                            <div class="services-container">
                                <div class="service-option">
                                    <input type="checkbox" id="melite" class="service-checkbox" value="melite">
                                    <label for="melite" class="service-label">mElite </label>
                                </div>
                                <div class="service-option">
                                    <input type="checkbox" id="meeting-rooms" class="service-checkbox" value="meeting-rooms">
                                    <label for="meeting-rooms" class="service-label">Meeting Rooms</label>
                                </div>
                                <div class="service-option">
                                    <input type="checkbox" id="po-box" class="service-checkbox" value="po-box">
                                    <label for="po-box" class="service-label">PO Box </label>
                                </div>
                                <div class="service-option">
                                    <input type="checkbox" id="mail-management" class="service-checkbox" value="mail-management">
                                    <label for="mail-management" class="service-label">Mail Management </label>
                                </div>
                                <div class="service-option">
                                    <input type="checkbox" id="document-translation" class="service-checkbox" value="document-translation">
                                    <label for="document-translation" class="service-label">Document Translation</label>
                                </div>
                                <div class="service-option">
                                    <input type="checkbox" id="virtual-assistant" class="service-checkbox" value="virtual-assistant">
                                    <label for="virtual-assistant" class="service-label">Virtual Assistant</label>
                                </div>
                            </div>
            </div>

                        <div class="services-category">
                            <h4>mAccounting</h4>
                            <div class="services-container">
                                <div class="service-option">
                                    <input type="checkbox" id="corporate-tax" class="service-checkbox tax-compliance-checkbox" value="corporate-tax" checked onchange="checkTaxCompliance()">
                                    <label for="corporate-tax" class="service-label">Corporate Tax</label>
                                </div>
                                <div class="service-option">
                                    <input type="checkbox" id="vat-registration" class="service-checkbox tax-compliance-checkbox" value="vat-registration" checked onchange="checkTaxCompliance()">
                                    <label for="vat-registration" class="service-label">VAT Registration</label>
                                </div>
                                <div class="service-option">
                                    <input type="checkbox" id="liquidation-report" class="service-checkbox" value="liquidation-report">
                                    <label for="liquidation-report" class="service-label">Liquidation Report</label>
                                </div>
                                <div class="service-option">
                                    <input type="checkbox" id="financial-audit-report" class="service-checkbox" value="financial-audit-report">
                                    <label for="financial-audit-report" class="service-label">Financial Audit Report</label>
                                </div>
                                <div class="service-option">
                                    <input type="checkbox" id="valuation-report" class="service-checkbox" value="valuation-report">
                                    <label for="valuation-report" class="service-label">Valuation Report</label>
                                </div>
                                <div class="service-option">
                                    <input type="checkbox" id="bookkeeping" class="service-checkbox" value="bookkeeping">
                                    <label for="bookkeeping" class="service-label">Bookkeeping</label>
                                </div>
                            </div>
                            <div id="tax-compliance-warning" class="tax-compliance-warning" style="display: none;">
                                <p>Corporate Tax and VAT Registration are mandatory for UAE businesses. We strongly recommend keeping these services.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-step" id="step-7">
                    <div class="summary-container">
                        <div class="summary-card">
                            <div class="summary-card-header">
                                <h3>Company Setup</h3>
                                <button type="button" class="card-edit-button" onclick="toggleEditMode('package-type')">
                                    <img src="https://cdn.prod.website-files.com/6746fa16829349829922b7c4/684aa9b0513a914ea32fd797_8f564e7b40f92fcf17afd82da9042501ff0956f1457deaf68f11bcb56e26d7ff.png" alt="Edit">
                                </button>
                            </div>
                            <div class="summary-card-content">
                                <div class="summary-item">
                                    <div class="summary-label">License Type</div>
                                    <div class="summary-value" id="summary-package-type">Standard</div>
                                </div>
                                <div class="summary-item">
                                    <div class="summary-label">License Duration</div>
                                    <div class="summary-value" id="summary-license-duration">1 year</div>
                                </div>
                                <div class="summary-item">
                                    <div class="summary-label">Shareholders</div>
                                    <div class="summary-value" id="summary-shareholders">1</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="summary-card">
                            <div class="summary-card-header">
                                <h3>Business Activities</h3>
                                <button type="button" class="card-edit-button" onclick="toggleEditMode('business-activities')">
                                    <img src="https://cdn.prod.website-files.com/6746fa16829349829922b7c4/684aa9b0513a914ea32fd797_8f564e7b40f92fcf17afd82da9042501ff0956f1457deaf68f11bcb56e26d7ff.png" alt="Edit">
                                </button>
                            </div>
                            <div class="summary-card-content" id="business-activities-summary">
                                <div class="activity-tags" id="activity-tags-container">
                                </div>
                                <div class="summary-value price" id="business-activities-cost">AED 1,000</div>
                            </div>
                        </div>
                        
                        <div class="summary-card">
                            <div class="summary-card-header">
                                <h3>Number of Visas</h3>
                                <button type="button" class="card-edit-button" onclick="toggleEditMode('visa-info')">
                                    <img src="https://cdn.prod.website-files.com/6746fa16829349829922b7c4/684aa9b0513a914ea32fd797_8f564e7b40f92fcf17afd82da9042501ff0956f1457deaf68f11bcb56e26d7ff.png" alt="Edit">
                                </button>
                            </div>
                            <div class="summary-card-content">
                                <div class="summary-item">
                                    <div class="summary-label">Investor Visa <span id="summary-investor-visa-display">(0)</span></div>
                                    <div class="summary-value price" id="investor-visa-cost">AED 0</div>
                                </div>
                                <div class="summary-item">
                                    <div class="summary-label">Employee Visa <span id="summary-employee-visa-display">(0)</span></div>
                                    <div class="summary-value price" id="employee-visa-cost">AED 0</div>
                                </div>
                                <div class="summary-item">
                                    <div class="summary-label">Dependency Visa <span id="summary-dependency-visa-display">(0)</span></div>
                                    <div class="summary-value price" id="dependency-visa-cost">AED 0</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="summary-card">
                            <div class="summary-card-header">
                                <h3>Office Type</h3>
                                <button type="button" class="card-edit-button" onclick="toggleEditMode('office-type')">
                                    <img src="https://cdn.prod.website-files.com/6746fa16829349829922b7c4/684aa9b0513a914ea32fd797_8f564e7b40f92fcf17afd82da9042501ff0956f1457deaf68f11bcb56e26d7ff.png" alt="Edit">
                                </button>
                            </div>
                            <div class="summary-card-content">
                                <div class="summary-item">
                                    <div class="summary-value" id="summary-office-type-display">None selected</div>
                                    <div class="summary-value price" id="office-space-cost-display">AED 0</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="summary-card">
                            <div class="summary-card-header">
                                <h3>Banking and Add-ons</h3>
                                <button type="button" class="card-edit-button" onclick="toggleEditMode('addons')">
                                    <img src="https://cdn.prod.website-files.com/6746fa16829349829922b7c4/684aa9b0513a914ea32fd797_8f564e7b40f92fcf17afd82da9042501ff0956f1457deaf68f11bcb56e26d7ff.png" alt="Edit">
                                </button>
                            </div>
                            <div class="summary-card-content" id="addons-summary-container">
                            </div>
                        </div>
                        
                        <div class="summary-card total-card">
                            <div class="summary-card-header total-card-header">
                                <h3>Total</h3>
                            </div>
                            <div class="summary-card-content">
                                <div class="summary-item">
                                    <div class="summary-value total-price" id="total-cost-display">AED 0</div>
                                </div>
                            </div>
                        </div>
                    </div>
                        </div>
        </div>

        <div class="form-navigation">
                <button class="d-none" type="button" id="prevBtn" onclick="prevStep()"><span>Previous</span></button>
            <button type="button" id="nextBtn" onclick="nextStep()"><span>Next</span> <svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M5.5 12H19.5M19.5 12L12.5 5M19.5 12L12.5 19" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg></button>
            <button class="d-none" type="button" id="submitBtn"><span style="margin-right: 5px;">Get a Call</span> <svg xmlns="http://www.w3.org/2000/svg" width="8" height="12" viewBox="0 0 8 12" fill="none">
                <path d="M1.72266 10.5206L6.51532 5.72797L1.72266 0.935303" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg></button>
            </div>
        </div>
    </form>
            <div id="theFinalSuccessMessage" class="d-none">
                <h2>Thank you, <span id="success-first-name"></span>!</h2>
                <p>Your enquiry has been submitted successfully. One of our Business Setup Advisors will contact you soon.</p>
            </div>
            
                    </div>
</div>
</section>

<div id="my-calculator-elementor-form" style="display: none;">
    <input type="hidden" name="form_fields[fullName]" value="">
    <input type="hidden" name="form_fields[phone]" value="">
    <input type="hidden" name="form_fields[email]" value="">
    <input type="hidden" name="form_fields[license_type]" value="">
    <input type="hidden" name="form_fields[shareholders_range]" value="">
    <input type="hidden" name="form_fields[nationalities]" value="">
    <input type="hidden" name="form_fields[shareholder_nationalities]" value="">
    <input type="hidden" name="form_fields[package_type]" value="">
    <input type="hidden" name="form_fields[license_duration]" value="">
    <input type="hidden" name="form_fields[investor_visas]" value="">
    <input type="hidden" name="form_fields[employee_visas]" value="">
    <input type="hidden" name="form_fields[dependency_visas]" value="">
    <input type="hidden" name="form_fields[business_activities]" value="">
    <input type="hidden" name="form_fields[business_bank_account]" value="">
    <input type="hidden" name="form_fields[total_cost]" value="">
    <input type="hidden" name="form_fields[license_cost]" value="">
    <input type="hidden" name="form_fields[visa_cost]" value="">
    <input type="hidden" name="form_fields[bank_cost]" value="">
    <input type="hidden" name="form_fields[form_status]" value="">
    <input type="hidden" name="form_fields[client_id]" value="">
    <button type="submit" id="wf-submit" style="display: none;"></button>
</div>

<div id="success-message" style="display: none;">
    <h3>Thank you for your submission!</h3>
    <p>One of our representatives will contact you shortly.</p>
</div>

<script>
    let currentStep = 1;
    const totalSteps = 6; 
    const displayTotalSteps = 7; 
    let selectedActivities = []; 

    let LicenseCost = 0;
    let VisaCost = 0;
    let inactivityTimer;
    const INACTIVITY_TIMEOUT = 60000; 
    let firstStepData = null;
    let hasStartedForm = false;
    let hasSubmittedIncomplete = false;

    document.addEventListener('DOMContentLoaded', function() {
        try {
            hasStartedForm = false;
            updateProgressBar(1);
            
            sessionStorage.removeItem('editMode');
            sessionStorage.removeItem('returnToStep');
            
            document.querySelectorAll('.activity-count').forEach(count => {
                count.style.display = 'none';
            });
            
            selectedActivities = [];
            
            document.querySelectorAll('.activity-group').forEach(group => {
                group.addEventListener('click', function() {
                    this.classList.toggle('selected');
                    
                    if (this.classList.contains('selected') && this.getAttribute('data-count') === "0") {
                        this.setAttribute('data-count', "0");
                        
                        const countElement = this.querySelector('.activity-count');
                        if (!countElement) {
                            const countSpan = document.createElement('span');
                            countSpan.className = 'activity-count';
                            countSpan.textContent = ' (0)';
                            this.appendChild(countSpan);
                        } else {
                            countElement.textContent = ' (0)';
                        }
                        
                        const plusIcon = this.querySelector('.plus-icon');
                        if (plusIcon) {
                            plusIcon.style.display = 'inline-flex';
                            plusIcon.style.visibility = 'visible';
                        }
                    } else if (!this.classList.contains('selected')) {
                        this.setAttribute('data-count', "0");
                        
                        const plusIcon = this.querySelector('.plus-icon');
                        if (plusIcon) {
                            plusIcon.style.display = 'none';
                            plusIcon.style.visibility = 'hidden';
                        }
                    }
                    
                    const selectedGroups = document.querySelectorAll('.activity-group.selected');
                    document.getElementById('groups-selected-count').textContent = selectedGroups.length;
                    
                    let totalActivities = 0;
                    selectedGroups.forEach(group => {
                        totalActivities += parseInt(group.getAttribute('data-count') || "0");
                    });
                    document.getElementById('activities-selected-count').textContent = totalActivities;
                    
                    selectedActivities = [];
                    selectedGroups.forEach(group => {
                        const groupName = group.textContent.trim().split('(')[0].trim();
                        const count = parseInt(group.getAttribute('data-count') || "0");
                        
                        for (let i = 1; i <= count; i++) {
                            selectedActivities.push(groupName + ' Activity ' + i);
                        }
                    });
                });
            });
            
            const searchInput = document.querySelector('.activity-search-input');
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase().trim();
                    
                    document.querySelectorAll('.activity-group').forEach(group => {
                        const groupText = group.textContent.toLowerCase();
                        if (searchTerm === '' || groupText.includes(searchTerm)) {
                            group.style.display = 'flex';
                        } else {
                            group.style.display = 'none';
                        }
                    });
                });
            }
        } catch (err) {
            console.error("Error during DOMContentLoaded initialization:", err);
        }
    });

    document.addEventListener('change', function(e) {
        const isFormField = e.target.tagName === 'INPUT' || 
                            e.target.tagName === 'SELECT' || 
                            e.target.tagName === 'TEXTAREA';
        
        if (isFormField && !hasStartedForm) {
            hasStartedForm = true;
        }
    });

    function updateProgressBar(step) {
        const progressBar = document.querySelector('#MFZ-NewCostCalForm .step-progress');
        
        if (progressBar) {
            let progressWidth;
            switch(step) {
                case 1: progressWidth = '12%'; break;
                case 2: progressWidth = '25%'; break;
                case 3: progressWidth = '42%'; break;
                case 4: progressWidth = '57%'; break;
                case 5: progressWidth = '71%'; break;
                case 6: progressWidth = '85%'; break;
                case 7: progressWidth = '100%'; break;
                default: progressWidth = '12%';
            }
            progressBar.style.width = progressWidth;
        }
    }

    function updateProgressPill(step) {
        const displayStep = (step > totalSteps) ? totalSteps : step;
        document.getElementById("current-step").innerText = displayStep;

        const stepDisplay = document.getElementById("heading-top-right-numbs-steps-1");
        if (stepDisplay) {
            const currentStepElem = document.getElementById("current-step");
            if (currentStepElem && stepDisplay.textContent.includes('/')) {
                stepDisplay.innerHTML = `<span class="step-word">Step</span> <span id="current-step">${displayStep}</span>/${displayTotalSteps}`;
            }
        }
        
        updateProgressBar(step);
    }
    updateProgressPill(currentStep);

    document.getElementById("heading-top-right-numbs-steps-1").classList.add("step-text-colored");
    document.querySelector(".step-word").style.color = "#6226FF";

    function changeHeading(step){
        const headings = {
            1: "Get Started",
            2: "Company Setup",
            3: "Business Activity Selection",
            4: "Visa Types",
            5: "Office Selection",
            6: "Banking and Add-ons",
            7: "Summary"
        };
        document.getElementById("theHeading").innerHTML = headings[step] || "Summary";
        updateStepDisplay();
    }

    function updateStepDisplay() {
        const currentStepDisplay = document.getElementById("current-step");
        if (currentStepDisplay) {
            const displayStep = (currentStep > totalSteps) ? totalSteps : currentStep;
            currentStepDisplay.textContent = displayStep;
        }
        
        if (currentStep > totalSteps || currentStep === 7) {
            document.getElementById("theHeading").innerHTML = "Summary";
            document.querySelectorAll('.form-step').forEach(step => step.classList.remove('active'));
            document.getElementById('step-7').classList.add('active');
        }
    }

    function updateButtonsDisplay(step) {
        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");
        const submitBtn = document.getElementById("submitBtn");
        const isInEditMode = sessionStorage.getItem('editMode') === 'true';

        prevBtn.classList.toggle("d-none", step === 1);
        
        if (step >= 7) { 
            nextBtn.classList.add("d-none");
            submitBtn.classList.remove("d-none");
            if (isInEditMode) {
                sessionStorage.removeItem('editMode');
                sessionStorage.removeItem('returnToStep');
            }
            
            calculateCosts();
        } else if (step === 6) {
            nextBtn.classList.remove("d-none");
            submitBtn.classList.add("d-none");
            
            if (isInEditMode) {
                nextBtn.querySelector('span').textContent = "Back to Summary";
            } else {
            nextBtn.querySelector('span').textContent = "View Summary";
            }
        } else {
            nextBtn.classList.remove("d-none");
            submitBtn.classList.add("d-none");
            
            if (isInEditMode) {
                nextBtn.querySelector('span').textContent = "Back to Summary";
            } else {
            nextBtn.querySelector('span').textContent = "Next";
            }
        }
    }

    function nextStep() {
        if(validateStep(currentStep)){
            if (currentStep <= totalSteps) {
                document.getElementById(`step-${currentStep}`).classList.remove("active");
                
                const isInEditMode = sessionStorage.getItem('editMode') === 'true';
                
                                 if (isInEditMode) {
                     // If in edit mode, go directly to summary step
                     currentStep = 7;
                     document.getElementById('step-7').classList.add("active");
                     // Edit mode is reset in updateButtonsDisplay
                 } else {
                    // Normal flow - go to next step
                currentStep++;

                if (currentStep > totalSteps) {
                    document.querySelectorAll('.form-step').forEach(step => step.classList.remove('active'));
                    document.getElementById('step-7').classList.add("active");
                } else {
                    document.getElementById(`step-${currentStep}`).classList.add("active");
                    }
                }

                changeHeading(currentStep);
                updateStepDisplay();
                updateButtonsDisplay(currentStep);
                calculateCosts();
                updateProgressBar(currentStep);

                hasStartedForm = true;
                setupInactivityTimer();
            }
        }
    }

    function prevStep() {
        if (currentStep > 1) {
            document.getElementById(`step-${currentStep}`).classList.remove("active");
            currentStep--;
            document.getElementById(`step-${currentStep}`).classList.add("active");
            
            // Update navigation elements
            changeHeading(currentStep);
            updateStepDisplay();
            updateButtonsDisplay(currentStep);
            updateProgressBar(currentStep);
            
            // Reset inactivity timer
            setupInactivityTimer();
        }
    }

    function validateStep(step) {
        let valid = true;
        const stepElement = document.getElementById(`step-${step}`);
        const inputs = stepElement.querySelectorAll("input:not([type='radio']), select");

        document.querySelectorAll('.error-message').forEach(el => el.textContent = '');
        document.querySelectorAll('.error').forEach(el => el.classList.remove('error'));

        inputs.forEach(input => {
            const errorElement = document.getElementById(`${input.id}-error`);
            const isVisible = input.offsetParent !== null;

            if (isVisible && input.hasAttribute("required") && !input.value) {
                input.classList.add('error');
                if (errorElement) errorElement.textContent = "This field is required";
                valid = false;
            }

            if (isVisible && input.type === "email" && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(input.value)) {
                input.classList.add('error');
                if (errorElement) errorElement.textContent = "Please enter a valid email address";
                valid = false;
            }

            if (isVisible && input.type === "tel" && !phoneInput.isValidNumber()) {
                input.classList.add('error');
                if (errorElement) errorElement.textContent = "Please enter a valid phone number";
                valid = false;
            }

            if (isVisible && input.id === "full-name" && !/^[A-Za-z\s]+$/.test(input.value)) {
                input.classList.add('error');
                if (errorElement) errorElement.textContent = "Name should contain only letters and spaces";
                valid = false;
            }
        });

        if (step === 2) {
            if (!document.getElementById("fawri-license").checked && !document.getElementById("regular-license").checked) {
                const licenseOptionsContainer = document.querySelector('.license-type-options');
                if (!licenseOptionsContainer.querySelector('.error-message')) {
                    const licenseErrorElement = document.createElement('div');
                    licenseErrorElement.className = 'error-message';
                    licenseErrorElement.textContent = "Please select a license type";
                    licenseOptionsContainer.appendChild(licenseErrorElement);
                }
                valid = false;
            }
        }
        
        // Validate business activities in step 3
        if (step === 3) {
            if (window.selectedActivities.length === 0) {
                const activitiesContainer = document.getElementById('step-3');
                if (activitiesContainer && !activitiesContainer.querySelector('.activity-error')) {
                    const activityErrorElement = document.createElement('div');
                    activityErrorElement.className = 'error-message activity-error';
                    activityErrorElement.textContent = "Please select at least one business activity";
                    activityErrorElement.style.textAlign = "center";
                    activityErrorElement.style.marginTop = "15px";
                    activityErrorElement.style.padding = "10px";
                    activityErrorElement.style.borderRadius = "8px";
                    activityErrorElement.style.backgroundColor = "rgba(235, 95, 64, 0.1)";
                    activityErrorElement.style.color = "#EB5F400";
                    activityErrorElement.style.fontWeight = "500";
                    activityErrorElement.style.fontSize = "14px";
                    activityErrorElement.style.fontFamily = "Plus Jakarta Sans";
                    activityErrorElement.style.width = "100%";
                    
                    // Insert before the selection summary
                    const selectionSummary = activitiesContainer.querySelector('.selection-summary');
                    if (selectionSummary) {
                        activitiesContainer.insertBefore(activityErrorElement, selectionSummary);
                    } else {
                        activitiesContainer.appendChild(activityErrorElement);
                    }
                }
                valid = false;
            }
        }
        
        if (step === 1 && valid) {
            firstStepData = {
                fullName: document.getElementById("full-name").value,
                phone: document.getElementById("phone").value,
                email: document.getElementById("email").value
            };
            setupInactivityTimer();
        }

        return valid;
    }

    function updateShareholderNationalities() {
        const count = parseInt(document.getElementById("shareholders-range").value) || 0;
        const container = document.getElementById("shareholder-nationalities-container");
        container.innerHTML = '';
        
        if (count > 0) {
            for (let i = 0; i < count; i++) {
                const selectId = `shareholder-nationality-${i+1}`;
                
                const select = document.createElement('select');
                select.id = selectId;
                select.className = 'nationality-select';
                select.required = true;
                
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.disabled = true;
                defaultOption.selected = true;
                defaultOption.textContent = `Nationality of Shareholder ${i+1}`;
                select.appendChild(defaultOption);
                
                countries.forEach(country => {
                    const option = document.createElement('option');
                    option.value = country;
                    option.textContent = country;
                    select.appendChild(option);
                });
                
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-message';
                errorDiv.id = `${selectId}-error`;
                
                container.appendChild(select);
                container.appendChild(errorDiv);
            }
            
            $('.nationality-select').select2({
                placeholder: "Select Nationality",
                width: '100%'
            });
        }
    }
        
    function getFormSnapshot() {
        const investorVisaToggle = document.getElementById('investor-visa-toggle');
        const employeeVisaToggle = document.getElementById('employee-visa-toggle');
        const dependencyVisaToggle = document.getElementById('dependency-visa-toggle');

        const selectedAddonsList = [];
        document.querySelectorAll('.service-checkbox:checked').forEach(checkbox => {
            selectedAddonsList.push(checkbox.value);
        });

        return {
            licenseType: document.getElementById("fawri-license").checked ? "fawri" : "regular",
            packageType: "standard",
            licenseDuration: parseInt(document.getElementById("license-duration")?.value) || 1,
            investorVisas: (investorVisaToggle && investorVisaToggle.checked) ? parseInt(document.getElementById("investor-visa-count").value) || 0 : 0,
            employeeVisas: (employeeVisaToggle && employeeVisaToggle.checked) ? parseInt(document.getElementById("employee-visa-count").value) || 0 : 0,
            dependencyVisas: (dependencyVisaToggle && dependencyVisaToggle.checked) ? parseInt(document.getElementById("dependency-visas").value) || 0 : 0,
            businessBankAccount: document.getElementById("bank-account")?.checked,
            officeType: document.getElementById("office-type")?.value || '',
            selectedAddons: selectedAddonsList,
        };
    }

    function calculateAddonsCost(snapshot) {
        let cost = 0;
        const { selectedAddons, investorVisas, employeeVisas, dependencyVisas } = snapshot;
        const addonCosts = {
            // mCore
            "bank-account": 1500,
            "business-card": 240,
            "company-stamp": 200,
            "ecommerce-starter": 1000,
            
            // mResidency
            "medical-emirates-id": 2250,
            "dependent-visa": 6000,
            "eid-card-delivery": 250,
            "medical-insurance": 1080,
            
            // mAssist
            "melite": 6000,
            "meeting-rooms": 150,
            "po-box": 1700,
            "mail-management": 750,
            "document-translation": 250,
            "virtual-assistant": 12000,
            
            // mAccounting
            "corporate-tax": 1200,
            "vat-registration": 1500,
            "liquidation-report": 1000,
            "financial-audit-report": 250,
            "valuation-report": 10000,
            "bookkeeping": 1000
        };

        selectedAddons.forEach(addon => {
            cost += addonCosts[addon] || 0;
        });

        if (selectedAddons.includes("medical-insurance")) {
            cost += 800 * (investorVisas + employeeVisas + dependencyVisas);
        }

        return cost;
    }

    function calculateOfficeCost(snapshot) {
        return 0;
    }

    function calculateVisaCost(snapshot) {
        let visaAdditionalCosts = 0;
        const { investorVisas, employeeVisas, dependencyVisas } = snapshot;
        const hasAnyVisa = investorVisas > 0 || employeeVisas > 0 || dependencyVisas > 0;

        if (investorVisas > 0) {
            visaAdditionalCosts += (2200 * investorVisas) + (700 * investorVisas);
            visaAdditionalCosts += 2280;
        }

        if (employeeVisas > 0) visaAdditionalCosts += (3700 * employeeVisas);
        if (dependencyVisas > 0) visaAdditionalCosts += (3700 * dependencyVisas);
        if (hasAnyVisa) visaAdditionalCosts += 330;
        
        return visaAdditionalCosts;
    }

    function calculateLicenseCost(snapshot) {
        const { licenseType, packageType, licenseDuration, investorVisas, employeeVisas } = snapshot;
        
        let baseLicenseCost = 0;
        if (licenseType === "fawri") {
            baseLicenseCost = 15000; // AED 15,000 for Fawri License
        } else {
            baseLicenseCost = 12500; // AED 12,500 for Regular License
        }

        let discountPercentage = licenseDuration > 1 ? 15 : 0; // 15% discount for multi-year licenses

        let businessLicenseCost = baseLicenseCost * licenseDuration;
        let leaseAgreementTotal = 375 * licenseDuration;

        let totalBeforeDiscount = businessLicenseCost + leaseAgreementTotal;
        let discountAmount = totalBeforeDiscount * (discountPercentage / 100);
        let licenseAfterDiscount = totalBeforeDiscount - discountAmount + 10;
        
        let immigrationCardTotal = (investorVisas > 0 || employeeVisas > 0) ? 2000 : 0;
        
        return licenseAfterDiscount + immigrationCardTotal;
    }

    function updateSummaryUI(costs, snapshot) {
        const { licenseCost, visaCost, bankAccountCost, officeCost, addonsCost, totalCost } = costs;
        const { licenseType, packageType, licenseDuration, officeType, investorVisas, employeeVisas, dependencyVisas, selectedAddons } = snapshot;

        // Update package type and license duration
        let packageText = licenseType === 'fawri' ? "Fawri" : "Regular";
        document.getElementById("summary-package-type").innerText = packageText;
        document.getElementById("summary-license-duration").innerText = `${licenseDuration} year${licenseDuration > 1 ? "s" : ""}`;
        
        // Update shareholders count
        const shareholdersCount = parseInt(document.getElementById("shareholders-range")?.value) || 1;
        document.getElementById("summary-shareholders").innerText = shareholdersCount;
        
        // Update business activities summary
        const activityTagsContainer = document.getElementById("activity-tags-container");
        if (activityTagsContainer) {
            activityTagsContainer.innerHTML = '';
            
            // Check if we're using the new window.selectedActivities array
            if (window.selectedActivities && window.selectedActivities.length > 0) {
                // Group activities by category
                const activityGroups = {};
                
                // First, create a list of all unique groups
                window.selectedActivities.forEach(activity => {
                    const groupName = activity.groupName || mapCategoryToGroup(activity.Category, activity.Group);
                    if (!activityGroups[groupName]) {
                        activityGroups[groupName] = [];
                    }
                    activityGroups[groupName].push(activity);
                });
                
                // Create tags for each category (not individual activities)
                Object.keys(activityGroups).forEach(groupName => {
                    const activities = activityGroups[groupName];
                    
                    // Create a tag for the group with count
                    const tag = document.createElement('span');
                    tag.className = 'activity-tag';
                    tag.innerText = `${mapGroupToDisplayName(groupName)} (${activities.length})`;
                    activityTagsContainer.appendChild(tag);
                });
                
                // Update business activities cost
                const businessActivitiesCost = document.getElementById("business-activities-cost");
                if (businessActivitiesCost) {
                    // Calculate cost based on number of groups (first 3 are free, then 1000 AED per additional group)
                    const uniqueGroups = Object.keys(activityGroups).length;
                    const extraGroups = Math.max(0, uniqueGroups - 3);
                    const activitiesCostValue = extraGroups * 1000;
                    businessActivitiesCost.innerText = `AED ${activitiesCostValue.toLocaleString()}`;
                    businessActivitiesCost.style.textAlign = "right";
                    businessActivitiesCost.style.width = "100%";
                    businessActivitiesCost.style.marginTop = "12px";
                }
            } else {
                // Fallback to old method for backward compatibility
                const activityGroups = {};
                selectedActivities.forEach(activity => {
                    const groupMatch = activity.match(/(.*?) Activity/);
                    if (groupMatch && groupMatch[1]) {
                        const group = groupMatch[1].trim();
                        if (!activityGroups[group]) {
                            activityGroups[group] = 0;
                        }
                        activityGroups[group]++;
                    }
                });
                
                // Create tags for each group
                Object.keys(activityGroups).forEach(group => {
                    const tag = document.createElement('span');
                    tag.className = 'activity-tag';
                    tag.innerText = `${group} (${activityGroups[group]})`;
                    activityTagsContainer.appendChild(tag);
                });
                
                // Update business activities cost
                const businessActivitiesCost = document.getElementById("business-activities-cost");
                if (businessActivitiesCost) {
                    const activitiesCostValue = Object.keys(activityGroups).length > 0 ? 1000 : 0;
                    businessActivitiesCost.innerText = `AED ${activitiesCostValue.toLocaleString()}`;
                }
            }
        }
        
        // Helper function to map group names to display names
        function mapGroupToDisplayName(groupName) {
            const groupDisplayNames = {
                'administrative': 'Administrative',
                'agriculture': 'Agriculture',
                'art': 'Art',
                'education': 'Education',
                'ict': 'ICT',
                'fnb': 'F&B, Rentals',
                'financial': 'Financial',
                'healthcare': 'Health Care',
                'maintenance': 'Maintenance',
                'services': 'Services',
                'professional': 'Professional',
                'realestate': 'Real Estate',
                'sewerage': 'Sewerage',
                'trading': 'Trading',
                'transportation': 'Transportation',
                'waste': 'Waste Collection',
                'manufacturing': 'Manufacturing'
            };
            return groupDisplayNames[groupName] || groupName;
        }
        
        // Update visa information
        document.getElementById("summary-investor-visa-display").innerText = investorVisas > 0 ? `(${investorVisas})` : "(0)";
        document.getElementById("summary-employee-visa-display").innerText = employeeVisas > 0 ? `(${employeeVisas})` : "(0)";
        document.getElementById("summary-dependency-visa-display").innerText = dependencyVisas > 0 ? `(${dependencyVisas})` : "(0)";
        
        // Calculate individual visa costs (including allocation fees)
        const investorVisaCost = investorVisas > 0 ? (2200 + 1850) * investorVisas : 0; // Added 1850 allocation fee per visa
        const employeeVisaCost = employeeVisas > 0 ? (3700 + 1600) * employeeVisas : 0; // Added 1600 allocation fee per visa
        const dependencyVisaCost = dependencyVisas > 0 ? 6000 * dependencyVisas : 0; // AED 6,000 per dependent visa
        
        document.getElementById("investor-visa-cost").innerText = investorVisaCost > 0 ? `AED ${investorVisaCost.toLocaleString()}` : 'AED 0';
        document.getElementById("employee-visa-cost").innerText = employeeVisaCost > 0 ? `AED ${employeeVisaCost.toLocaleString()}` : 'AED 0';
        document.getElementById("dependency-visa-cost").innerText = dependencyVisaCost > 0 ? `AED ${dependencyVisaCost.toLocaleString()}` : 'AED 0';
        
        // Update office type (no cost impact)
        const officeTypeDisplay = document.getElementById("summary-office-type-display");
        const officeSpaceCostDisplay = document.getElementById("office-space-cost-display");
        
        if (officeType) {
            const officeTypeName = officeType === 'shared-office' ? 'Shared Office / Shared Desk' : 'Dedicated Office';
            officeTypeDisplay.innerText = officeTypeName;
            officeSpaceCostDisplay.innerText = "Included"; // No cost impact
        } else {
            officeTypeDisplay.innerText = "None selected";
            officeSpaceCostDisplay.innerText = "Included"; // No cost impact
        }

        // Update banking and add-ons
        const addonsContainer = document.getElementById("addons-summary-container");
        addonsContainer.innerHTML = '';

        const addonDetails = {
            // Group 1: mCore
            "bank-account": { name: "Bank Account", cost: 1500, group: "mCore" },
            "business-card": { name: "Business Card", cost: 240, group: "mCore" },
            "company-stamp": { name: "Company Stamp", cost: 200, group: "mCore" },
            "ecommerce-starter": { name: "E-commerce Starter", cost: 1000, group: "mCore" },
            
            // Group 2: mResidency
            "medical-emirates-id": { name: "Medical & Emirates ID", cost: 2250, group: "mResidency" },
            "dependent-visa": { name: "Dependent Visa", cost: 6000, group: "mResidency" },
            "eid-card-delivery": { name: "EID Card Delivery", cost: 250, group: "mResidency" },
            "medical-insurance": { name: "Medical Insurance", cost: 1080, group: "mResidency" },

            // Group 3: mAssist
            "melite": { name: "mElite", cost: 6000, group: "mAssist" },
            "meeting-rooms": { name: "Meeting Rooms", cost: 150, group: "mAssist" },
            "po-box": { name: "P.O. Box", cost: 1700, group: "mAssist" },
            "mail-management": { name: "Mail Management", cost: 750, group: "mAssist" },
            "document-translation": { name: "Document Translation", cost: 250, group: "mAssist" },
            "virtual-assistant": { name: "Virtual Assistant", cost: 12000, group: "mAssist" },

            // Group 4: mAccounting
            "corporate-tax": { name: "Corporate Tax", cost: 1200, group: "mAccounting" },
            "vat-registration": { name: "VAT Registration", cost: 1500, group: "mAccounting" },
            "liquidation-report": { name: "Liquidation Report", cost: 1000, group: "mAccounting" },
            "financial-audit-report": { name: "Financial Audit Report", cost: 250, group: "mAccounting" },
            "valuation-report": { name: "Valuation Report", cost: 10000, group: "mAccounting" },
            "bookkeeping": { name: "Bookkeeping", cost: 1000, group: "mAccounting" }
        };

        const groupedAddons = {};
        selectedAddons.forEach(addonKey => {
            const addon = addonDetails[addonKey];
            if (addon) {
                if (!groupedAddons[addon.group]) {
                    groupedAddons[addon.group] = [];
                }
                groupedAddons[addon.group].push(addon);
            }
        });

        if (Object.keys(groupedAddons).length === 0) {
            addonsContainer.innerHTML = '<span class="no-addons">No optional services selected</span>';
        } else {
            // Define unified costs for each group
            const groupCosts = {
                "mCore": 2250,
                "mResidency": 1000,
                "mAssist": 1000,
                "mAccounting": 1000
            };
            
            Object.keys(groupedAddons).forEach(groupName => {
                const addons = groupedAddons[groupName];
                
                const groupSection = document.createElement('div');
                groupSection.className = 'summary-section';

                const groupHeader = document.createElement('h4');
                groupHeader.innerText = groupName;
                groupSection.appendChild(groupHeader);

                const itemsContainer = document.createElement('div');
                itemsContainer.className = 'addon-item-container';

                // Add each add-on with its individual price
                addons.forEach(addon => {
                    const addonRow = document.createElement('div');
                    addonRow.className = 'addon-item';
                    addonRow.style.width = '100%';
                    addonRow.style.display = 'flex';
                    addonRow.style.justifyContent = 'space-between';
                    addonRow.style.alignItems = 'center';
                    addonRow.style.marginBottom = '8px';
                    
                    const addonNameSpan = document.createElement('span');
                    addonNameSpan.className = 'addon-name';
                    addonNameSpan.textContent = addon.name;
                    
                    const addonCostSpan = document.createElement('span');
                    addonCostSpan.className = 'addon-cost';
                    addonCostSpan.textContent = `AED ${addon.cost.toLocaleString()}`;
                    addonCostSpan.style.marginLeft = 'auto';
                    addonCostSpan.style.flexShrink = '0';
                    
                    addonRow.appendChild(addonNameSpan);
                    addonRow.appendChild(addonCostSpan);
                    itemsContainer.appendChild(addonRow);
                });
                
                groupSection.appendChild(itemsContainer);
                addonsContainer.appendChild(groupSection);
            });
        }
        
        // Update total cost
        document.getElementById("total-cost-display").innerText = `AED ${Math.round(totalCost).toLocaleString()}`;
    }

    function calculateCosts() {
        const snapshot = getFormSnapshot();
        
        const licenseComponent = calculateLicenseCost(snapshot);
        const visaComponent = calculateVisaCost(snapshot);
        const bankAccountComponent = snapshot.businessBankAccount ? 2000 : 0;
        const officeComponent = calculateOfficeCost(snapshot);
        const addonsComponent = calculateAddonsCost(snapshot);
        
        const totalCost = licenseComponent + visaComponent + bankAccountComponent + officeComponent + addonsComponent;
        
        const costs = {
            licenseCost: licenseComponent,
            visaCost: visaComponent,
            bankAccountCost: bankAccountComponent,
            officeCost: officeComponent,
            addonsCost: addonsComponent,
            totalCost: totalCost
        };
        
        LicenseCost = Math.round(licenseComponent);
        VisaCost = Math.round(visaComponent);

        updateSummaryUI(costs, snapshot);
        
        // Save form data to localStorage for potential recovery
        try {
            localStorage.setItem('costCalculatorData', JSON.stringify(snapshot));
        } catch (e) {
            console.log('Unable to save form data to localStorage', e);
        }
    }

    function calculateTotalCost() {
        return (parseInt(document.getElementById("license-cost").innerText.replace(/,/g, '')) || 0) +
               (parseInt(document.getElementById("visa-cost").innerText.replace(/,/g, '')) || 0) +
               (parseInt(document.getElementById("bank-account-cost").innerText.replace(/,/g, '')) || 0);
    }

    function submitPartialData(step, status = 'incomplete') {
        const shareholdersCount = parseInt(document.getElementById("shareholders-range").value) || 0;
        const shareholderNationalities = Array.from({ length: shareholdersCount }, (_, i) => document.getElementById(`shareholder-nationality-${i+1}`)?.value || '');

        const selectedAddons = [];
        document.querySelectorAll('.service-checkbox:checked').forEach(checkbox => selectedAddons.push(checkbox.value));

        const formData = {
            fullName: document.getElementById("full-name")?.value || '',
            phone: phoneInput.getNumber(),
            email: document.getElementById("email")?.value || '',
            license_type: document.getElementById("fawri-license").checked ? "fawri" : (document.getElementById("regular-license").checked ? "regular" : ""),
            business_activities: selectedActivities.join(', '),
            shareholders_range: document.getElementById("shareholders-range")?.value || '',
            nationalities: "Default Nationality",
            shareholder_nationalities: shareholderNationalities.join(','),
            package_type: document.getElementById("package-type")?.value || '',
            license_duration: document.getElementById("license-duration")?.value || '',
            investor_visas: document.getElementById("investor-visa-toggle").checked ? (document.getElementById("investor-visa-count")?.value || '0') : '0',
            employee_visas: document.getElementById("employee-visa-toggle").checked ? (document.getElementById("employee-visa-count")?.value || '0') : '0',
            dependency_visas: document.getElementById("dependency-visa-toggle").checked ? (document.getElementById("dependency-visas")?.value || '0') : '0',
            office_type: document.getElementById("office-type")?.value || '',
            selected_addons: selectedAddons.join(','),
            bank_account: document.getElementById("bank-account")?.checked ? 'yes' : 'no',
            business_bank_account: document.getElementById("business-bank-account")?.value || '',
            current_step: step,
            total_cost: calculateTotalCost(),
            license_cost: LicenseCost,
            visa_cost: VisaCost,
            bank_cost: document.getElementById("bank-account")?.checked ? 2000 : 0,
            client_id: document.getElementById("client-id")?.value || '',
            form_status: status
        };

        const elementorForm = $('#my-calculator-elementor-form');
        if (elementorForm.length > 0) {
            Object.keys(formData).forEach(key => {
                const field = elementorForm.find(`input[name="form_fields[${key}]"]`);
                if (field.length > 0) field.val(formData[key]);
            });
            elementorForm.find('.elementor-button[type="submit"]').click();
            hasSubmittedIncomplete = true;
        }
    }

    let lastActivityTime = Date.now();
    ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'].forEach(eventName => {
        document.addEventListener(eventName, () => { lastActivityTime = Date.now(); });
    });

    function setupInactivityTimer() {
        if (inactivityTimer) clearTimeout(inactivityTimer);
        if (hasSubmittedIncomplete) return;
        
        inactivityTimer = setTimeout(() => {
            const timeSinceLastActivity = Date.now() - lastActivityTime;
            if (timeSinceLastActivity >= INACTIVITY_TIMEOUT && hasStartedForm && !hasSubmittedIncomplete && currentStep <= totalSteps) {
                submitPartialData(currentStep, 'incomplete_timeout');
            } else {
                setupInactivityTimer();
            }
        }, 10000);
    }

    window.addEventListener('beforeunload', function(e) {
        if (hasStartedForm && !document.getElementById('submitBtn').disabled && !hasSubmittedIncomplete && currentStep <= totalSteps) {
            submitPartialData(currentStep, 'incomplete_leave');
            const confirmationMessage = 'You have an unfinished form. Are you sure you want to leave?';
            e.preventDefault();
            e.returnValue = confirmationMessage;
            return confirmationMessage;
        }
    });

    document.addEventListener('visibilitychange', function() {
        if (document.visibilityState === 'hidden' && hasStartedForm && !hasSubmittedIncomplete && currentStep <= totalSteps) {
            submitPartialData(currentStep, 'incomplete_hidden');
        }
    });

    const phoneInputField = document.querySelector("#phone");
    const phoneInput = window.intlTelInput(phoneInputField, {
        preferredCountries: ["ae", "sa", "kw", "bh", "om", "qa"],
        utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
        separateDialCode: true,
        formatOnDisplay: true,
        autoPlaceholder: "polite"
    });

    phoneInputField.addEventListener("blur", function() {
        phoneInputField.classList.toggle("error", phoneInputField.value.trim() && !phoneInput.isValidNumber());
    });

    document.getElementById('submitBtn').addEventListener('click', function(e) {
        e.preventDefault();
        const submitBtn = this;

        if (submitBtn.classList.contains('button-loading')) return;

        clearTimeout(inactivityTimer);
        hasSubmittedIncomplete = true; 

        submitBtn.classList.add('button-loading');
        submitBtn.disabled = true;

        calculateCosts();

        const fullName = document.getElementById("full-name").value;
        const phone = phoneInput.getNumber();
        const email = document.getElementById("email").value;
        const licenseType = document.getElementById("fawri-license").checked ? "fawri" : "regular";
        
        const shareholdersCount = parseInt(document.getElementById("shareholders-range").value) || 0;
        const shareholderNationalities = Array.from({length: shareholdersCount}, (_,i) => document.getElementById(`shareholder-nationality-${i+1}`)?.value || '');

        const elementorForm = $('#my-calculator-elementor-form');
        if (elementorForm.length > 0) {
            elementorForm.find('input[name="form_fields[fullName]"]').val(fullName);
            elementorForm.find('input[name="form_fields[phone]"]').val(phone);
            elementorForm.find('input[name="form_fields[email]"]').val(email);
            elementorForm.find('input[name="form_fields[license_type]"]').val(licenseType);
            elementorForm.find('input[name="form_fields[shareholders_range]"]').val(document.getElementById("shareholders-range").value);
            elementorForm.find('input[name="form_fields[nationalities]"]').val("Default Nationality");
            elementorForm.find('input[name="form_fields[shareholder_nationalities]"]').val(shareholderNationalities.join(','));
            elementorForm.find('input[name="form_fields[business_activities]"]').val(selectedActivities.join(', '));
            elementorForm.find('input[name="form_fields[total_cost]"]').val(calculateTotalCost());
            elementorForm.find('input[name="form_fields[license_cost]"]').val(LicenseCost);
            elementorForm.find('input[name="form_fields[visa_cost]"]').val(VisaCost);
            elementorForm.find('input[name="form_fields[bank_cost]"]').val(document.getElementById("bank-account")?.checked ? 2000 : 0);
            elementorForm.find('input[name="form_fields[form_status]"]').val('complete');

            setTimeout(function() {
                const submitButton = elementorForm.find('.elementor-button[type="submit"]');
                if (submitButton.length > 0) {
                    submitButton.click();
                    
                    document.querySelector('#MFZ-NewCostCalForm .form-container').style.display = 'none';
                    const successMessage = document.getElementById('theFinalSuccessMessage');
                    document.getElementById('success-first-name').textContent = fullName.split(' ')[0] || '';
                    successMessage.classList.remove('d-none');
                    successMessage.classList.add('visible');
                } else {
                    submitBtn.classList.remove('button-loading');
                    submitBtn.disabled = false;
                    alert("There was an issue submitting the form. Please try again.");
                }
            }, 1000);
        } else {
            submitBtn.classList.remove('button-loading');
            submitBtn.disabled = false;
            alert("There was an issue submitting the form. Please try again later.");
        }
    });

    const countries = [
        "Afghanistan", "Albania", "Algeria", "Andorra", "Angola", "Antigua and Barbuda", "Argentina", "Armenia", "Australia", "Austria",
        "Azerbaijan", "Bahamas", "Bahrain", "Bangladesh", "Barbados", "Belarus", "Belgium", "Belize", "Benin", "Bhutan",
        "Bolivia", "Bosnia and Herzegovina", "Botswana", "Brazil", "Brunei", "Bulgaria", "Burkina Faso", "Burundi", "Cabo Verde", "Cambodia",
        "Cameroon", "Canada", "Central African Republic", "Chad", "Chile", "China", "Colombia", "Comoros", "Congo", "Costa Rica",
        "Croatia", "Cuba", "Cyprus", "Czech Republic", "Denmark", "Djibouti", "Dominica", "Dominican Republic", "East Timor", "Ecuador",
        "Egypt", "El Salvador", "Equatorial Guinea", "Eritrea", "Estonia", "Eswatini", "Ethiopia", "Fiji", "Finland", "France",
        "Gabon", "Gambia", "Georgia", "Germany", "Ghana", "Greece", "Grenada", "Guatemala", "Guinea", "Guinea-Bissau",
        "Guyana", "Haiti", "Honduras", "Hungary", "Iceland", "India", "Indonesia", "Iran", "Iraq", "Ireland",
        "Israel", "Italy", "Jamaica", "Japan", "Jordan", "Kazakhstan", "Kenya", "Kiribati", "Korea, North", "Korea, South",
        "Kosovo", "Kuwait", "Kyrgyzstan", "Laos", "Latvia", "Lebanon", "Lesotho", "Liberia", "Libya", "Liechtenstein",
        "Lithuania", "Luxembourg", "Madagascar", "Malawi", "Malaysia", "Maldives", "Mali", "Malta", "Marshall Islands", "Mauritania",
        "Mauritius", "Mexico", "Micronesia", "Moldova", "Monaco", "Mongolia", "Montenegro", "Morocco", "Mozambique", "Myanmar",
        "Namibia", "Nauru", "Nepal", "Netherlands", "New Zealand", "Nicaragua", "Niger", "Nigeria", "North Macedonia", "Norway",
        "Oman", "Pakistan", "Palau", "Palestine", "Panama", "Papua New Guinea", "Paraguay", "Peru", "Philippines", "Poland",
        "Portugal", "Qatar", "Romania", "Russia", "Rwanda", "Saint Kitts and Nevis", "Saint Lucia", "Saint Vincent and the Grenadines", "Samoa", "San Marino",
        "Sao Tome and Principe", "Saudi Arabia", "Senegal", "Serbia", "Seychelles", "Sierra Leone", "Singapore", "Slovakia", "Slovenia", "Solomon Islands",
        "Somalia", "South Africa", "South Sudan", "Spain", "Sri Lanka", "Sudan", "Suriname", "Sweden", "Switzerland", "Syria",
        "Taiwan", "Tajikistan", "Tanzania", "Thailand", "Togo", "Tonga", "Trinidad and Tobago", "Tunisia", "Turkey", "Turkmenistan",
        "Tuvalu", "Uganda", "Ukraine", "United Arab Emirates", "United Kingdom", "United States", "Uruguay", "Uzbekistan", "Vanuatu", "Vatican City",
        "Venezuela", "Vietnam", "Yemen", "Zambia", "Zimbabwe"
    ];

    document.addEventListener('DOMContentLoaded', function() {
        if (localStorage.getItem('formHasPartialData') === 'true') {
            try {
                localStorage.removeItem('formHasPartialData');
                localStorage.removeItem('formPartialData');
            } catch (err) {
                console.error("Error clearing localStorage:", err);
            }
        }
        
        updateProgressBar(currentStep);
        updateStepDisplay();
        
        if (currentStep === 1) {
            document.querySelectorAll('.form-step').forEach(step => step.classList.remove('active'));
            document.getElementById('step-1').classList.add('active');
        }
        
        const stepDisplay = document.getElementById("heading-top-right-numbs-steps-1");
        if (stepDisplay) {
            stepDisplay.innerHTML = `<span class="step-word">Step</span> <span id="current-step">1</span>/${displayTotalSteps}`;
        }
        
        updateButtonsDisplay(currentStep);

        const fawriLicense = document.getElementById("fawri-license");
        const regularLicense = document.getElementById("regular-license");
        
        if (fawriLicense && regularLicense) {
            fawriLicense.addEventListener('change', () => {
                if (fawriLicense.checked) document.querySelector('.duration-value').textContent = "60 Minutes";
            });
            
            regularLicense.addEventListener('change', () => {
                if (regularLicense.checked) document.querySelector('.duration-value').textContent = "3-5 Business Days";
            });
            
            fawriLicense.checked = true;
            document.querySelector('.duration-value').textContent = "60 Minutes";
        }
        
        checkTaxCompliance();
    });

    function toggleVisaOptions(visaType) {
        const toggle = document.getElementById(`${visaType}-visa-toggle`);
        const optionsDiv = document.getElementById(`${visaType}-visa-options`);
        const visaSelect = document.getElementById(visaType === 'dependency' ? 'dependency-visas' : `${visaType}-visa-count`);
        
        if (toggle.checked) {
            optionsDiv.style.display = 'block';
            visaSelect.setAttribute('required', 'required');
        } else {
            optionsDiv.style.display = 'none';
            visaSelect.removeAttribute('required');
            visaSelect.value = '';
            const errorElement = document.getElementById(visaSelect.id + '-error');
            if (errorElement) errorElement.textContent = '';
        }
        
        if (currentStep >= 5) calculateCosts();
    }
    
    function checkTaxCompliance() {
        const corporateTaxChecked = document.getElementById('corporate-tax').checked;
        const vatRegistrationChecked = document.getElementById('vat-registration').checked;
        const warningElement = document.getElementById('tax-compliance-warning');
        
        warningElement.style.display = (!corporateTaxChecked || !vatRegistrationChecked) ? 'block' : 'none';
        
        calculateCosts();
    }

    // Toggle inline edit mode for summary items
    function toggleEditMode(editType) {
    // Instead of showing edit forms, navigate to the respective step
    switch(editType) {
        case 'package-type':
            // Navigate to step 2 (Company Setup)
            goToStep(2);
            break;
        case 'business-activities':
            // Navigate to step 3 (Business Activities)
            goToStep(3);
            break;
        case 'visa-info':
            // Navigate to step 4 (Visa Options)
            goToStep(4);
            break;
        case 'office-type':
            // Navigate to step 5 (Office Type)
            goToStep(5);
            break;
        case 'addons':
            // Navigate to step 6 (Add-ons)
            goToStep(6);
            break;
    }
    
    // Store that we're in edit mode and the original step we came from
    sessionStorage.setItem('editMode', 'true');
    sessionStorage.setItem('returnToStep', '7');
}
    
    // Edit form functions removed as we now navigate to steps directly
    
    // Function to navigate to a specific step
    function goToStep(stepNumber) {
        if (stepNumber < 1 || stepNumber > totalSteps + 1) {
            return;
        }
        
        // Hide all steps
        document.querySelectorAll('.form-step').forEach(step => {
            step.classList.remove('active');
        });
        
        // Show the selected step
        const targetStep = document.getElementById(`step-${stepNumber}`);
        if (targetStep) {
            targetStep.classList.add('active');
            currentStep = stepNumber;
            
            // Update progress bar
            updateProgressBar(stepNumber);
            
            // If coming from summary page, set edit mode
            if (stepNumber < 7 && !sessionStorage.getItem('editMode') && currentStep !== 1) {
                sessionStorage.setItem('editMode', 'true');
                sessionStorage.setItem('returnToStep', '7');
            }
            
            // If going to the summary step, recalculate costs
            if (stepNumber === 7) {
                calculateCosts();
            }
            
            // Update navigation buttons and heading after setting edit mode
            changeHeading(stepNumber);
            updateStepDisplay();
            updateButtonsDisplay(stepNumber);
            
            // Scroll to top of form
            const formContainer = document.querySelector('.form-container');
            if (formContainer) {
                formContainer.scrollIntoView({ behavior: 'smooth' });
            }
            
            // Reset inactivity timer
            setupInactivityTimer();
        }
    }



    window.addEventListener('focus', function() {
        setupInactivityTimer();
    });
  </script>

<!-- Add Supabase script before closing body tag -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
    // Initialize Supabase client
    const supabaseUrl = 'https://sb.meydanfz.ae';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlzcyI6InN1cGFiYXNlIiwiaWF0IjoxNzU3MjQyMDM2LCJleHAiOjIwNzI4MTgwMzZ9.5YF79Wen41bSpKNOKiT9Wcd_psXf8IV4vgK7RUjOZoI';
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    window.selectedActivities = window.selectedActivities || [];
    
    document.addEventListener('DOMContentLoaded', function() {
        const placeholder = document.querySelector('#activities-list-placeholder');
        if (placeholder) {
            const existingList = document.querySelector('.activities-list-container');
            if (existingList) placeholder.appendChild(existingList);
        }
        
        const searchInput = document.querySelector('.activity-search-input');
        
        updateSelectionSummary();
        
        const searchResultsDropdown = document.createElement('div');
        searchResultsDropdown.className = 'search-results-dropdown';
        searchResultsDropdown.style.display = 'none';
        
        const searchContainer = document.querySelector('.activity-search-container');
        searchContainer.style.position = 'relative';
        searchContainer.appendChild(searchResultsDropdown);
        
        function updateDropdownDimensions() {
            searchResultsDropdown.style.width = searchInput.getBoundingClientRect().width + 'px';
            searchResultsDropdown.style.left = searchInput.offsetLeft + 'px';
        }
        
        updateDropdownDimensions();
        window.addEventListener('resize', updateDropdownDimensions);
        
        document.querySelectorAll('.activity-group').forEach(group => {
            group.addEventListener('click', function(e) {
                e.stopPropagation();
                const groupName = this.getAttribute('data-group');
                const activitiesList = document.querySelector('.activities-list-container');
                const isActivitiesVisible = activitiesList && activitiesList.style.display !== 'none' && activitiesList.getAttribute('data-current-group') === groupName;
                
                if (isActivitiesVisible) {
                    activitiesList.style.display = 'none';
                } else {
                    toggleActivityGroup(this, groupName);
                    document.querySelectorAll('.activity-group').forEach(g => {
                        g.style.opacity = (g !== this) ? '0.7' : '1';
                        if (g === this && g.querySelector('.plus-icon')) g.querySelector('.plus-icon').style.display = 'inline-flex';
                    });
                }
            });
        });
        
        function toggleActivityGroup(groupElement, groupName) {
            if (!groupElement.classList.contains('selected')) {
                groupElement.classList.add('selected');
                groupElement.style.opacity = '1';
                if(groupElement.querySelector('.plus-icon')) groupElement.querySelector('.plus-icon').style.display = 'inline-flex';
                document.querySelectorAll('.activity-group:not(.selected)').forEach(otherGroup => otherGroup.style.opacity = '0.7');
                updateSelectionSummary();
            }
            fetchActivitiesByGroup(groupName);
        }
        
        async function fetchActivitiesByGroup(groupName) {
            try {
                window.currentGroupName = groupName;
                showActivitiesLoading(groupName);
                const categoryName = mapGroupToCategory(groupName);
                const { data, error } = await supabase.from('Activity List').select('Code, "Activity Name", Category, Group').eq('Category', categoryName).order('Code').limit(100);
                if (error) throw error;
                displayActivitiesWithCheckboxes(data, groupName);
            } catch (err) {
                console.error('Error fetching activities:', err);
                showActivitiesError('Error fetching activities', groupName);
            }
        }
        
        function mapGroupToCategory(groupName) {
            const groupToCategoryMap = { 'administrative': 'Administrative', 'agriculture': 'Agriculture', 'art': 'Art', 'education': 'Education', 'ict': 'ICT', 'fnb': 'F&B', 'financial': 'Financial', 'healthcare': 'HealthCare', 'maintenance': 'Maintenance', 'services': 'Services', 'professional': 'Professional', 'realestate': 'Realestate', 'sewerage': 'Sewerage', 'trading': 'Trading', 'transportation': 'Transportation', 'waste': 'Waste Collection', 'manufacturing': 'Manufacturing' };
            return groupToCategoryMap[groupName] || groupName;
        }
        
        function showActivitiesLoading(groupName) {
            let activitiesList = document.querySelector('.activities-list-container');
            if (!activitiesList) {
                activitiesList = document.createElement('div');
                activitiesList.className = 'activities-list-container';
                document.querySelector('#activities-list-placeholder').appendChild(activitiesList);
            }
            activitiesList.innerHTML = '<div class="activities-loading">Loading activities...</div>';
            activitiesList.style.display = 'block';
            activitiesList.setAttribute('data-current-group', groupName);
        }
        
        function showActivitiesError(message, groupName) {
            let activitiesList = document.querySelector('.activities-list-container');
            if (!activitiesList) {
                activitiesList = document.createElement('div');
                activitiesList.className = 'activities-list-container';
                document.querySelector('#activities-list-placeholder').appendChild(activitiesList);
            }
            activitiesList.innerHTML = `<div class="activities-error">${message}</div>`;
            activitiesList.style.display = 'block';
            if (window.currentGroupName) activitiesList.setAttribute('data-current-group', window.currentGroupName);
        }

        function displayActivitiesWithCheckboxes(activities, groupName) {
            let activitiesList = document.querySelector('.activities-list-container');
            if (!activitiesList) {
                activitiesList = document.createElement('div');
                activitiesList.className = 'activities-list-container';
                document.querySelector('#activities-list-placeholder').appendChild(activitiesList);
            }
            
            if (!activities || activities.length === 0) {
                activitiesList.innerHTML = '<div class="no-activities">No activities found for this category</div>';
                activitiesList.style.display = 'block';
                return;
            }
            
            const selectedActivityCodes = window.selectedActivities.filter(a => a.groupName === groupName).map(a => a.Code);
            
            let html = `<div class="activities-filter"><input type="text" class="activities-filter-input" placeholder="Filter activities in ${mapGroupToCategory(groupName)}..." /></div><div class="activities-list">`;
            activities.forEach(activity => {
                const isSelected = selectedActivityCodes.includes(activity.Code);
                html += `<div class="activity-checkbox-item"><label class="activity-checkbox-label"><div class="activity-checkbox-info"><span class="activity-code">${activity.Code}</span><span class="activity-name">${activity["Activity Name"]}</span></div><input type="checkbox" class="activity-checkbox" data-code="${activity.Code}" data-name="${activity["Activity Name"]}" data-category="${activity.Category}" data-group="${activity.Group}" ${isSelected ? 'checked' : ''}></label></div>`;
            });
            html += '</div>';
            activitiesList.innerHTML = html;
            activitiesList.style.display = 'block';
            activitiesList.setAttribute('data-current-group', groupName);
            
            activitiesList.querySelectorAll('.activity-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const activityData = { Code: this.dataset.code, "Activity Name": this.dataset.name, Category: this.dataset.category, Group: this.dataset.group };
                    this.checked ? selectActivity(activityData) : removeActivity(activityData.Code);
                });
            });
            
            document.addEventListener('click', function(e) {
                if (!activitiesList.contains(e.target) && !e.target.closest('.activity-group') && activitiesList.style.display !== 'none') {
                    activitiesList.style.display = 'none';
                }
            });
            
            activitiesList.addEventListener('click', e => e.stopPropagation());
            
            const filterInput = activitiesList.querySelector('.activities-filter-input');
            if (filterInput) {
                setTimeout(() => filterInput.focus(), 100);
                filterInput.addEventListener('input', function() {
                    const filterValue = this.value.toLowerCase().trim();
                    activitiesList.querySelectorAll('.activity-checkbox-item').forEach(item => {
                        item.style.display = item.textContent.toLowerCase().includes(filterValue) ? '' : 'none';
                    });
                });
            }
        }
        
        let debounceTimer;
        searchInput.addEventListener('input', function(e) {
            const searchTerm = e.target.value.trim();
            clearTimeout(debounceTimer);
            document.querySelectorAll('.activity-group').forEach(group => group.style.display = 'flex');
            
            if (searchTerm === '') {
                searchResultsDropdown.style.display = 'none';
                return;
            }
            
            updateDropdownDimensions();
            debounceTimer = setTimeout(() => searchActivities(searchTerm), 300);
        });
        
        async function searchActivities(searchTerm) {
            try {
                searchResultsDropdown.innerHTML = '<div class="loading-results">Searching...</div>';
                searchResultsDropdown.style.display = 'block';
                updateDropdownDimensions();
                
                const query = searchTerm === "*" ? supabase.from('Activity List').select('Code, "Activity Name", Category, Group').limit(40) : supabase.from('Activity List').select('Code, "Activity Name", Category, Group').or(`"Activity Name".ilike.%${searchTerm}%,Code.ilike.%${searchTerm}%`).limit(100);
                const { data, error } = await query;
                if (error) throw error;
                displaySearchResults(data);
            } catch (err) {
                console.error('Error searching activities:', err);
                searchResultsDropdown.innerHTML = '<div class="error-results">Error fetching results</div>';
            }
        }
        
        function displaySearchResults(results) {
            searchResultsDropdown.innerHTML = '';
            document.querySelectorAll('.activity-group').forEach(group => group.style.display = 'flex');
            
            if (results.length === 0) {
                searchResultsDropdown.innerHTML = '<div class="no-results">No activities found</div>';
                searchResultsDropdown.style.display = 'block';
                updateDropdownDimensions();
                return;
            }
            
            results.forEach(activity => {
                const resultItem = document.createElement('div');
                resultItem.className = 'search-result-items';
                resultItem.innerHTML = `<span class="activity-code">${activity.Code}</span><span class="activity-name">${activity["Activity Name"]}</span>`;
                resultItem.addEventListener('click', () => selectActivity(activity));
                searchResultsDropdown.appendChild(resultItem);
            });
            
            searchResultsDropdown.style.display = 'block';
            updateDropdownDimensions();
        }
        
        function selectActivity(activity) {
            const groupName = mapCategoryToGroup(activity.Category, activity.Group);
            const groupElement = document.querySelector(`.activity-group[data-group="${groupName}"]`);
            
            if (groupElement) {
                groupElement.style.display = 'flex';
                document.querySelectorAll('.activity-group').forEach(g => { if (g !== groupElement && !g.classList.contains('selected')) g.style.opacity = '0.7'; });
                
                if (!groupElement.classList.contains('selected')) {
                    groupElement.classList.add('selected');
                    groupElement.style.opacity = '1';
                }
                
                if (window.selectedActivities.some(item => item.Code === activity.Code)) return;
                
                let currentCount = parseInt(groupElement.dataset.count || '0') + 1;
                groupElement.dataset.count = currentCount;
                
                const countElement = groupElement.querySelector('.activity-count');
                if (countElement) {
                    countElement.textContent = `(${currentCount})`;
                    countElement.style.display = 'inline';
                }
                
                addActivityToSelected(activity, groupName);
                updateSelectionSummary();
                
                const checkbox = document.querySelector(`.activity-checkbox[data-code="${activity.Code}"]`);
                if (checkbox) checkbox.checked = true;
                
                if (!document.activeElement || !document.activeElement.classList.contains('activity-checkbox')) {
                    searchInput.value = '';
                    searchResultsDropdown.style.display = 'none';
                }
                document.querySelectorAll('.activity-group').forEach(group => group.style.display = 'flex');
            }
        }
        
        function mapCategoryToGroup(category, groupNumber) {
            const categoryMapping = { 'Administrative': 'administrative', 'Agriculture': 'agriculture', 'Art': 'art', 'Education': 'education', 'ICT': 'ict', 'F&B,Rentals': 'fnb', 'Financial': 'financial', 'HealthCare': 'healthcare', 'Maintenance': 'maintenance', 'Services': 'services', 'Professional': 'professional', 'Realestate': 'realestate', 'Sewerage': 'sewerage', 'Trading': 'trading', 'Transportation': 'transportation', 'Waste Collection': 'waste', 'Manufacturing': 'manufacturing' };
            let cleanCategory = typeof category === 'string' ? category.trim() : '';
            if (cleanCategory && categoryMapping[cleanCategory]) return categoryMapping[cleanCategory];
            for (const [key, value] of Object.entries(categoryMapping)) {
                if (cleanCategory && (cleanCategory.includes(key) || cleanCategory.toLowerCase().includes(key.toLowerCase()))) return value;
            }
            return 'services';
        }
        
        function addActivityToSelected(activity, groupName) {
            if (!window.selectedActivities.some(item => item.Code === activity.Code)) {
                window.selectedActivities.push({ ...activity, groupName });
                
                // Clear any error messages when activity is added
                const errorMessage = document.querySelector('.activity-error');
                if (errorMessage) {
                    errorMessage.remove();
                }
            }
        }
        
        function updateSelectionSummary() {
            const groupsSelectedCount = document.getElementById('groups-selected-count');
            const activitiesSelectedCount = document.getElementById('activities-selected-count');
            if (!groupsSelectedCount || !activitiesSelectedCount) return;
            
            const totalActivities = window.selectedActivities.length;
            const activeGroups = new Set(window.selectedActivities.map(a => a.groupName));
            
            groupsSelectedCount.textContent = activeGroups.size;
            activitiesSelectedCount.textContent = totalActivities;
        }
        
        function removeActivity(code) {
            const activityIndex = window.selectedActivities.findIndex(a => a.Code === code);
            if (activityIndex === -1) return;
            
            const { groupName } = window.selectedActivities[activityIndex];
            window.selectedActivities.splice(activityIndex, 1);
            
            const checkbox = document.querySelector(`.activity-checkbox[data-code="${code}"]`);
            if (checkbox) checkbox.checked = false;
            
            const groupElement = document.querySelector(`.activity-group[data-group="${groupName}"]`);
            if (groupElement) {
                let currentCount = Math.max(0, (parseInt(groupElement.dataset.count) || 0) - 1);
                groupElement.dataset.count = currentCount;
                const countElement = groupElement.querySelector('.activity-count');
                if (countElement) countElement.style.display = currentCount > 0 ? 'inline' : 'none';
            }
            
            if (window.selectedActivities.length === 0) {
                document.querySelectorAll('.activity-group').forEach(group => group.style.opacity = '1');
            }
            updateSelectionSummary();
        }
    });
</script>

<style>
.search-results-dropdown {
    position: absolute;
    max-height: 300px;
    overflow-y: scroll;
    background: white;
    border: 1px solid #DCDCDC;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    z-index: 100;
    margin-top: 5px;
    left: 0;
    top: 100%;
    box-sizing: border-box;
}
.search-result-items {
    padding: 16px 9px !important;
    color: rgba(28, 28, 28, 0.80);
    font-family: "Plus Jakarta Sans";
    font-size: 14px;
    font-style: normal;
    font-weight: 400;
    line-height: 24px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 3px !important;
}
.search-result-items:last-child { border-bottom: none; }
.search-result-items:hover { background-color: rgba(171, 129, 197, 0.05); }
.activity-code {
    color: rgba(28, 28, 28, 0.80);
    font-family: "Plus Jakarta Sans";
    font-size: 14px;
    font-style: normal;
    font-weight: 500;
    line-height: 24px;
    margin-right: 8px;
}
.activity-name { font-size: 14px; color: #333; font-weight: 400; }
.no-results, .loading-results, .error-results { padding: 16px; text-align: center; color: #808080; font-size: 14px; }
.error-results { color: #E74C3C; }

.activities-list-container {
    margin-top: 20px;
    padding: 12px 16px !important;
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    border: 1px solid #EFEFEF;
    overflow: hidden;
    max-height: 235px;
    display: flex;
    flex-direction: column;
    margin-bottom: 24px;
    z-index: 10;
}
#activities-list-placeholder {
    width: 100%;
    position: relative;
}
.activities-filter {
    padding: 8px 0;
    border-bottom: 1px solid #EFEFEF;
    background: #FFFFFF;
    position: sticky;
    top: 0;
    z-index: 1;
    margin-bottom: 8px;
}
.activities-filter-input {
    width: 100%;
    padding: 12px 16px;
    border: 1px solid #E0E0E0;
    border-radius: 8px;
    font-size: 14px;
    font-family: "Plus Jakarta Sans";
    outline: none;
    background-color: white;
    transition: all 0.2s ease;
    cursor: text;
}
.activities-filter-input:focus {
    border-color: #AB81C5;
    box-shadow: 0 0 0 2px rgba(171, 129, 197, 0.2);
}
.activities-list {
    overflow-y: auto;
    padding: 8px;
    max-height: 350px;
    scrollbar-width: thin;
    scrollbar-color: #D1D1D1 #F5F5F5;
}
.activities-list::-webkit-scrollbar { width: 6px; }
.activities-list::-webkit-scrollbar-track { background: #F5F5F5; border-radius: 6px; }
.activities-list::-webkit-scrollbar-thumb { background-color: #D1D1D1; border-radius: 6px; }
.activities-list::-webkit-scrollbar-thumb:hover { background-color: #AB81C5; }
.activity-checkbox-item {
    padding: 12px 16px;
    border-bottom: 1px solid #F5F5F5;
    transition: all 0.2s ease;
    border-radius: 8px;
    margin-bottom: 4px;
    cursor: pointer;
}
.activity-checkbox-item:hover { background-color: #F9F9F9; }
.activity-checkbox-item:last-child { border-bottom: none; }
.activity-checkbox-label {
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
    gap: 12px;
    width: 100%;
}
.activity-checkbox {
    position: relative;
    width: 20px;
    height: 20px;
    cursor: pointer;
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    border: 1px solid #E0E0E0;
    border-radius: 4px;
    outline: none;
    transition: all 0.2s ease;
    background-color: white;
}
.activity-checkbox:checked {
    background: linear-gradient(163deg, #AB81C5 10.55%, #42B8C6 118.78%);
    border: none;
}
.activity-checkbox:checked::after {
    content: '';
    position: absolute;
    top: 2px;
    left: 6px;
    width: 5px;
    height: 10px;
    border: solid white;
    border-width: 0 2px 2px 0;
    transform: rotate(45deg);
}
.activity-checkbox:hover { border-color: #AB81C5; }
.activity-checkbox-info {
    display: flex;
    gap: 12px;
    align-items: center;
    flex: 1;
}
.activities-loading, .activities-error, .no-activities {
    padding: 24px;
    text-align: center;
    color: #808080;
    font-size: 14px;
}
</style>